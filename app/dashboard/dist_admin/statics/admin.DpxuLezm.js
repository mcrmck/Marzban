import{i as is,B as gr,a as mr,b as pr,d as P,r as Ds,z as fr,c as jr,f as br,e as jt,g as bt,h as vt,Q as vr,$ as yt,j as Ee,u as Ke,k as f,l as E,m as e,n as i,F as yr,T as p,o as Cr,p as Ge,s as Ct,q as Ie,J as Sr,t as oe,v as N,w as pe,x as wr,y as _r,D as q,A as Q,C as Z,E as ie,H as b,I as se,G as St,K as kr,L as qe,M as wt,N as Rr,O as _t,P as ce,R as Re,S as X,U as A,V as Dr,W as Tr,X as ve,Y as L,Z as ze,_ as Ts,a0 as Ue,a1 as $,a2 as kt,a3 as de,a4 as ue,a5 as Ls,a6 as Lr,a7 as Qe,a8 as Rt,a9 as Ae,aa as H,ab as Ne,ac as Ms,ad as Dt,ae as Tt,af as Ur,ag as Lt,ah as Ar,ai as Ut,aj as fe,ak as Er,al as Ir,am as zr,an as Nr,ao as At,ap as Fr,aq as ke,ar as Us,as as F,at as Pr,au as Bs,av as Hs,aw as Et,ax as As,ay as Es,az as je,aA as be,aB as It,aC as zt,aD as Nt,aE as Vs,aF as Wr,aG as $r,aH as Ys,aI as Ks,aJ as Or,aK as Gs,aL as Is,aM as Mr,aN as Ft,aO as zs,aP as Br,aQ as Hr,aR as Vr,aS as Yr,aT as O,aU as M,aV as ge,aW as cs,aX as qs,aY as Qs,aZ as Pt,a_ as Wt,a$ as $t,b0 as Ot,b1 as Kr,b2 as Mt,b3 as Bt,b4 as Ht,b5 as Gr,b6 as ds,b7 as Me,b8 as Be,b9 as qr,ba as Qr,bb as Zr,bc as Jr,bd as Xr,be as us,bf as hs,bg as xs,bh as gs,bi as Ze,bj as Vt,bk as Yt,bl as Kt,bm as ea,bn as sa,bo as ta,bp as ra,bq as aa,br as na,bs as oa,bt as la,bu as Gt,bv as ia,bw as ca,bx as da,by as ms,bz as ps,bA as le,bB as V,bC as fs,bD as ua,bE as B,bF as Zs,bG as ha,bH as xa,bI as ga,bJ as ma,bK as pa,bL as Js,bM as fa,bN as ja,bO as ba,bP as va,bQ as ya,bR as Ca,bS as Sa,bT as wa,bU as es,bV as ss,bW as ts,bX as _a,bY as ka,bZ as Ra,b_ as Da,b$ as Ta,c0 as La,c1 as Ua,c2 as Aa,c3 as Ea,c4 as Ia,c5 as za,c6 as Na,c7 as Fa,c8 as Pa,c9 as Wa,ca as $a,cb as Oa,cc as Ma,cd as Ba}from"./vendor.Cta-Oy3u.js";(function(){const r=document.createElement("link").relList;if(r&&r.supports&&r.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))a(n);new MutationObserver(n=>{for(const o of n)if(o.type==="childList")for(const c of o.addedNodes)c.tagName==="LINK"&&c.rel==="modulepreload"&&a(c)}).observe(document,{childList:!0,subtree:!0});function t(n){const o={};return n.integrity&&(o.integrity=n.integrity),n.referrerPolicy&&(o.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?o.credentials="include":n.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function a(n){if(n.ep)return;n.ep=!0;const o=t(n);fetch(n.href,o)}})();is.use(gr).use(mr).use(pr).init({debug:!1,returnNull:!1,fallbackLng:"en",interpolation:{escapeValue:!1},react:{useSuspense:!1,transSupportBasicHtmlNodes:!0,transKeepBasicHtmlNodesFor:["br","strong","i","em"],bindI18n:"languageChanged",bindI18nStore:"",transEmptyNodeValue:"",transWrapTextNodes:""},load:"languageOnly",detection:{caches:["localStorage","sessionStorage","cookie"]},backend:{loadPath:"/admin/statics/locales/{{lng}}.json"}},function(){P.locale(is.language)});is.on("languageChanged",s=>{P.locale(s)});Ds("zh-cn",fr);Ds("ru",jr);Ds("fa",br);const js={gray:{50:{value:"#fafaf9"},100:{value:"#f5f5f4"},200:{value:"#e7e5e4"},300:{value:"#d6d3d1"},400:{value:"#a8a29e"},500:{value:"#78716c"},600:{value:"#57534e"},700:{value:"#44403c"},800:{value:"#292524"},900:{value:"#1c1917"}},jade:{50:{value:"#f0fdf4"},100:{value:"#dcfce7"},200:{value:"#bbf7d0"},300:{value:"#86efac"},400:{value:"#4ade80"},500:{value:"#22c55e"},600:{value:"#16a34a"},700:{value:"#15803d"},800:{value:"#166534"},900:{value:"#14532d"},950:{value:"#0f2419"}},sage:{50:{value:"#f6f7f6"},100:{value:"#e8eae7"},200:{value:"#d1d5ce"},300:{value:"#b3bab0"},400:{value:"#8b9488"},500:{value:"#6b7066"},600:{value:"#565b52"},700:{value:"#454942"},800:{value:"#363834"},900:{value:"#2a2c28"},950:{value:"#1c1e1b"}},teal:{50:{value:"#f0fdfa"},100:{value:"#ccfbf1"},200:{value:"#99f6e4"},300:{value:"#5eead4"},400:{value:"#2dd4bf"},500:{value:"#14b8a6"},600:{value:"#0d9488"},700:{value:"#0f766e"},800:{value:"#115e59"},900:{value:"#134e4a"}},green:{50:{value:"#f0fdf4"},100:{value:"#dcfce7"},200:{value:"#bbf7d0"},300:{value:"#86efac"},400:{value:"#4ade80"},500:{value:"#22c55e"},600:{value:"#16a34a"},700:{value:"#15803d"},800:{value:"#166534"},900:{value:"#14532d"}},blue:{50:{value:"#eff6ff"},100:{value:"#dbeafe"},200:{value:"#bfdbfe"},300:{value:"#93c5fd"},400:{value:"#60a5fa"},500:{value:"#3b82f6"},600:{value:"#2563eb"},700:{value:"#1d4ed8"},800:{value:"#1e40af"},900:{value:"#1e3a8a"}},red:{50:{value:"#fff5f5"},100:{value:"#fed7d7"},200:{value:"#feb2b2"},300:{value:"#fc8181"},400:{value:"#f56565"},500:{value:"#e53e3e"},600:{value:"#c53030"},700:{value:"#9b2c2c"},800:{value:"#822727"},900:{value:"#63171b"}},yellow:{50:{value:"#fffff0"},100:{value:"#fefcbf"},200:{value:"#faf089"},300:{value:"#f6e05e"},400:{value:"#ecc94b"},500:{value:"#d69e2e"},600:{value:"#b7791f"},700:{value:"#975a16"},800:{value:"#744210"},900:{value:"#5F370E"}}},bs={colors:{"chakra-body-text":{value:{base:"{colors.gray.800}",_dark:"{colors.gray.100}"}},"chakra-body-bg":{value:{base:"{colors.gray.50}",_dark:"{colors.gray.900}"}},"chakra-border-color":{value:{base:"{colors.gray.200}",_dark:"{colors.gray.700}"}},"chakra-placeholder-color":{value:{base:"{colors.gray.400}",_dark:"{colors.gray.500}"}},"jade.solid":{value:{base:"{colors.jade.500}",_dark:"{colors.jade.400}"}},"jade.contrast":{value:{base:"white",_dark:"{colors.gray.900}"}},"jade.fg":{value:{base:"{colors.jade.600}",_dark:"{colors.jade.300}"}},"jade.muted":{value:{base:"{colors.jade.400}",_dark:"{colors.jade.500}"}},"jade.subtle":{value:{base:"{colors.jade.50}",_dark:"{colors.jade.950}"}},"jade.emphasized":{value:{base:"{colors.jade.100}",_dark:"{colors.jade.900}"}},"jade.focusRing":{value:{base:"{colors.jade.500}",_dark:"{colors.jade.400}"}},"sage.solid":{value:{base:"{colors.sage.500}",_dark:"{colors.sage.400}"}},"sage.contrast":{value:{base:"white",_dark:"{colors.gray.900}"}},"sage.fg":{value:{base:"{colors.sage.600}",_dark:"{colors.sage.300}"}},"sage.muted":{value:{base:"{colors.sage.400}",_dark:"{colors.sage.500}"}},"sage.subtle":{value:{base:"{colors.sage.50}",_dark:"{colors.sage.950}"}},"sage.emphasized":{value:{base:"{colors.sage.100}",_dark:"{colors.sage.900}"}},"bg.canvas":{value:{base:"{colors.gray.50}",_dark:"{colors.gray.900}"}},"bg.surface":{value:{base:"white",_dark:"{colors.gray.800}"}},"bg.subtle":{value:{base:"{colors.gray.100}",_dark:"{colors.gray.800}"}},"border.default":{value:{base:"{colors.gray.200}",_dark:"{colors.gray.700}"}},"border.emphasized":{value:{base:"{colors.gray.300}",_dark:"{colors.gray.600}"}}},shadows:{xs:{value:"0 0 0 1px rgba(0, 0, 0, 0.05)"},sm:{value:"0 1px 2px 0 rgba(0, 0, 0, 0.05)"},base:{value:"0 1px 3px 0 rgba(0, 0, 0, 0.1), 0 1px 2px 0 rgba(0, 0, 0, 0.06)"},md:{value:"0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06)"},lg:{value:"0 10px 15px -3px rgba(0, 0, 0, 0.1), 0 4px 6px -2px rgba(0, 0, 0, 0.05)"},xl:{value:"0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04)"}}},qt={fonts:{heading:{value:"Inter, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif"},body:{value:"Inter, -apple-system, BlinkMacSystemFont, 'Segoe UI', sans-serif"},mono:{value:"'JetBrains Mono', 'SF Mono', 'Monaco', 'Inconsolata', monospace"}},fontSizes:{xs:{value:"0.75rem"},sm:{value:"0.875rem"},md:{value:"1rem"},lg:{value:"1.125rem"},xl:{value:"1.25rem"},"2xl":{value:"1.5rem"},"3xl":{value:"1.875rem"},"4xl":{value:"2.25rem"},"5xl":{value:"3rem"},"6xl":{value:"3.75rem"}},fontWeights:{hairline:{value:"100"},thin:{value:"200"},light:{value:"300"},normal:{value:"400"},medium:{value:"500"},semibold:{value:"600"},bold:{value:"700"},extrabold:{value:"800"},black:{value:"900"}},lineHeights:{normal:{value:"normal"},none:{value:"1"},shorter:{value:"1.25"},short:{value:"1.375"},base:{value:"1.5"},tall:{value:"1.625"},taller:{value:"2"}}},Qt={px:{value:"1px"},0:{value:"0"},.5:{value:"0.125rem"},1:{value:"0.25rem"},1.5:{value:"0.375rem"},2:{value:"0.5rem"},2.5:{value:"0.625rem"},3:{value:"0.75rem"},3.5:{value:"0.875rem"},4:{value:"1rem"},5:{value:"1.25rem"},6:{value:"1.5rem"},7:{value:"1.75rem"},8:{value:"2rem"},9:{value:"2.25rem"},10:{value:"2.5rem"},12:{value:"3rem"},14:{value:"3.5rem"},16:{value:"4rem"},20:{value:"5rem"},24:{value:"6rem"},28:{value:"7rem"},32:{value:"8rem"},36:{value:"9rem"},40:{value:"10rem"},44:{value:"11rem"},48:{value:"12rem"},52:{value:"13rem"},56:{value:"14rem"},60:{value:"15rem"},64:{value:"16rem"},72:{value:"18rem"},80:{value:"20rem"},96:{value:"24rem"}},Ha={},Va=bt({theme:{tokens:{colors:js,...qt,spacing:Qt,radii:{none:{value:"0"},sm:{value:"0.125rem"},base:{value:"0.25rem"},md:{value:"0.375rem"},lg:{value:"0.5rem"},xl:{value:"0.75rem"},"2xl":{value:"1rem"},"3xl":{value:"1.5rem"},full:{value:"9999px"}}},semanticTokens:bs,recipes:Ha}});jt(vt,Va);const Ya=bt({theme:{tokens:{colors:{...js,brand:js.sage},...qt,spacing:Qt},semanticTokens:{colors:{...bs.colors,"brand.solid":{value:{base:"{colors.sage.500}",_dark:"{colors.sage.400}"}},"brand.contrast":{value:{base:"white",_dark:"{colors.gray.900}"}},"brand.fg":{value:{base:"{colors.sage.600}",_dark:"{colors.sage.300}"}},"brand.muted":{value:{base:"{colors.sage.400}",_dark:"{colors.sage.500}"}},"brand.subtle":{value:{base:"{colors.sage.50}",_dark:"{colors.sage.950}"}},"brand.emphasized":{value:{base:"{colors.sage.100}",_dark:"{colors.sage.900}"}},"brand.focusRing":{value:{base:"{colors.sage.500}",_dark:"{colors.sage.400}"}},"colorPalette.solid":{value:{base:"{colors.sage.500}",_dark:"{colors.sage.400}"}},"colorPalette.contrast":{value:{base:"white",_dark:"{colors.gray.900}"}},"colorPalette.fg":{value:{base:"{colors.sage.600}",_dark:"{colors.sage.300}"}},"colorPalette.muted":{value:{base:"{colors.sage.400}",_dark:"{colors.sage.500}"}},"colorPalette.subtle":{value:{base:"{colors.sage.50}",_dark:"{colors.sage.950}"}},"colorPalette.emphasized":{value:{base:"{colors.sage.100}",_dark:"{colors.sage.900}"}},"colorPalette.focusRing":{value:{base:"{colors.sage.500}",_dark:"{colors.sage.400}"}}},shadows:bs.shadows}}}),Ka=jt(vt,Ya),vs=new vr,Zt=s=>{document.documentElement.setAttribute("data-theme",s),document.documentElement.style.colorScheme=s},Ns="admin_token",Ga=()=>localStorage.getItem(Ns),qa=s=>{localStorage.setItem(Ns,s)},Qa=()=>{localStorage.removeItem(Ns)},Jt=Ga,Za=qa,Ja=Qa,Oe=yt.create({baseURL:void 0}),Xa=()=>{const s=()=>{const r=Jt();return r?{Authorization:`Bearer ${r}`}:{}};return{get:(r,t={})=>Oe(r,{...t,method:"GET",headers:s()}),post:(r,t,a={})=>Oe(r,{...a,method:"POST",body:t,headers:s()}),put:(r,t,a={})=>Oe(r,{...a,method:"PUT",body:t,headers:s()}),delete:(r,t={})=>Oe(r,{...t,method:"DELETE",headers:s()})}},Fe=Xa(),I=Fe,en=Ee(s=>({isLoading:!0,isPostLoading:!1,version:null,started:!1,logs_websocket:null,config:"",fetchCoreSettings:()=>{s({isLoading:!0}),Promise.all([I.get("/core").then(({version:r,started:t,logs_websocket:a})=>s({version:r,started:t,logs_websocket:a})),I.get("/core/config").then(r=>s({config:r}))]).finally(()=>s({isLoading:!1}))},updateConfig:r=>(s({isPostLoading:!0}),I.put("/core/config",r).then(()=>{s({isPostLoading:!1})})),restartCore:()=>I.post("/core/restart")}));function K(s,r=2,t=!1){if(!+s)return"0 B";const a=1024,n=r<0?0:r,o=["B","KB","MB","GB","TB","PB","EB","ZB","YB"],c=Math.floor(Math.log(s)/Math.log(a));return t?[parseFloat((s/Math.pow(a,c)).toFixed(n)),o[c]]:`${parseFloat((s/Math.pow(a,c)).toFixed(n))} ${o[c]}`}const Xs=s=>{if(s!==null)return s.toString().replace(/\B(?=(\d{3})+(?!\d))/g,",")},sn=({children:s})=>e.jsx(i,{w:5,h:5,position:"relative",zIndex:2,children:s}),rs=({title:s,content:r,icon:t})=>e.jsxs(i,{p:6,borderWidth:"1px",borderColor:"gray.200",bg:"white",_dark:{borderColor:"gray.600",bg:"gray.800"},borderStyle:"solid",boxShadow:"sm",borderRadius:"lg",width:"full",transition:"all 0.2s",_hover:{boxShadow:"md",transform:"translateY(-1px)"},children:[e.jsxs(i,{display:"flex",alignItems:"center",gap:3,mb:4,children:[e.jsx(i,{p:3,bg:"blue.500",borderRadius:"lg",color:"white",display:"flex",alignItems:"center",justifyContent:"center",children:e.jsx(sn,{children:t})}),e.jsx(p,{color:"gray.600",_dark:{color:"gray.300"},fontWeight:"medium",fontSize:"sm",lineHeight:"1.2",children:s})]}),e.jsx(i,{fontSize:"2xl",fontWeight:"bold",color:"gray.900",_dark:{color:"white"},lineHeight:"1.2",children:r||"—"})]}),ys=["statistics-query-key"],tn=s=>{const{version:r}=R(),{data:t}=Ke({queryKey:ys,queryFn:()=>I.get("/system"),refetchInterval:5e3});f.useEffect(()=>{t&&r!==t.version&&R.setState({version:t.version})},[t,r]);const{t:a}=E();return e.jsxs(i,{display:"grid",gridTemplateColumns:{base:"1fr",md:"repeat(2, 1fr)",lg:"repeat(3, 1fr)"},gap:6,...s,children:[e.jsx(rs,{title:a("activeUsers"),content:t&&e.jsxs(i,{display:"flex",alignItems:"baseline",gap:1,children:[e.jsx(p,{fontSize:"2xl",fontWeight:"bold",children:Xs(t.users_active)}),e.jsxs(p,{fontSize:"md",fontWeight:"medium",color:"gray.500",_dark:{color:"gray.400"},children:["/ ",Xs(t.total_user)]})]}),icon:e.jsx(yr,{})}),e.jsx(rs,{title:a("dataUsage"),content:t&&K(t.incoming_bandwidth+t.outgoing_bandwidth),icon:e.jsx(Cr,{})}),e.jsx(rs,{title:a("memoryUsage"),content:t&&e.jsxs(i,{display:"flex",alignItems:"baseline",gap:1,children:[e.jsxs(p,{fontSize:"2xl",fontWeight:"bold",children:[K(t.mem_used,1,!0)[0],e.jsx(p,{as:"span",fontSize:"sm",fontWeight:"medium",color:"gray.500",children:K(t.mem_used,1,!0)[1]})]}),e.jsxs(p,{fontSize:"md",fontWeight:"medium",color:"gray.500",_dark:{color:"gray.400"},children:["/ ",K(t.mem_total,1)]})]}),icon:e.jsx(Ge,{})})]})},Xt="marzban-num-users-per-page",et=10,rn=()=>{const s=localStorage.getItem(Xt)||et.toString();return parseInt(s)||et},an=s=>localStorage.setItem(Xt,s),nn=async s=>{const r={};Object.keys(s).forEach(t=>{const a=s[t];a!==void 0&&a!==""&&(r[t]=a)}),R.setState({loading:!0});try{const t=await I.get("/users",{query:r});return R.setState({users:t}),t}catch(t){return console.error("Failed to fetch users:",t),R.setState({users:{users:[],total:0}}),{users:[],total:0}}finally{R.setState({loading:!1})}},er=async()=>{R.setState({loading:!0});try{const s=await I.get("/inbounds");R.setState({inbounds:new Map(Object.entries(s))})}catch(s){console.error("Failed to fetch inbounds:",s),R.setState({inbounds:new Map})}finally{R.setState({loading:!1})}},R=Ee(Ct((s,r)=>({isCreatingNewUser:!1,editingUser:null,deletingUser:null,isEditingNodes:!1,isShowingNodesUsage:!1,isEditingCore:!1,isResetingAllUsage:!1,resetUsageUser:null,revokeSubscriptionUser:null,version:null,inbounds:new Map,users:{users:[],total:0},loading:!0,filters:{search:"",limit:rn(),offset:0,sort:"-created_at",status:void 0},subscribeUrl:null,QRcodeLinks:null,onCreateUser:t=>s({isCreatingNewUser:t,editingUser:null}),onEditingUser:t=>s({editingUser:t,isCreatingNewUser:!1}),onDeletingUser:t=>s({deletingUser:t}),onResetAllUsage:t=>s({isResetingAllUsage:t}),onEditingNodes:t=>s({isEditingNodes:t}),onShowingNodesUsage:t=>s({isShowingNodesUsage:t}),onResetUsageUser:t=>s({resetUsageUser:t}),onRevokeSubscriptionUser:t=>s({revokeSubscriptionUser:t}),setQRCode:t=>s({QRcodeLinks:t}),setSubLink:t=>s({subscribeUrl:t}),onFilterChange:t=>{const a=r().filters,n={...a,...t};(t.search!==void 0||t.status!==void 0||t.limit!==void 0&&t.limit!==a.limit)&&(n.offset=0),s({filters:n}),r().refetchUsers()},refetchUsers:()=>{nn(r().filters)},fetchAllInbounds:er,resetAllUsage:async()=>{await I.post("/users/reset"),r().onResetAllUsage(!1),r().refetchUsers()},deleteUser:async t=>{const a=t.account_number?.trim();if(!a)throw new Error("Invalid account number");await I.delete(`/user/${a}`),s({deletingUser:null}),r().refetchUsers(),vs.invalidateQueries({queryKey:ys})},createUser:async t=>{await I.post("/user",t),s({isCreatingNewUser:!1}),r().refetchUsers(),vs.invalidateQueries({queryKey:ys})},editUser:async t=>{const a=t.account_number?.trim();if(!a)throw new Error("Invalid account number");const n=await I.put(`/user/${a}`,t);return s({editingUser:null}),r().refetchUsers(),n},fetchUserUsage:async(t,a)=>{const n=t.account_number?.trim();if(!n)throw new Error("Invalid account number");const o={};return Object.keys(a).forEach(c=>{a[c]&&(o[c]=a[c])}),I.get(`/user/${n}/usage`,{query:o})},resetDataUsage:async t=>{const a=t.account_number?.trim();if(!a)throw new Error("Invalid account number");await I.post(`/user/${a}/reset`),r().refetchUsers()},resetUserUsage:async t=>{const a=t.trim();if(!a)throw new Error("Invalid account number");await I.post(`/user/${a}/reset`),r().refetchUsers()},revokeSubscription:async t=>{const a=t.account_number?.trim();if(!a)throw new Error("Invalid account number");const n=await I.post(`/user/${a}/revoke_sub`);return s({revokeSubscriptionUser:null}),n?.account_number?s(o=>({users:{...o.users,users:o.users.users.map(c=>c.account_number===n.account_number?n:c)},editingUser:o.editingUser?.account_number===n.account_number?n:o.editingUser})):r().refetchUsers(),n}})));window.ace.define("ace/theme/nord_dark",["require","exports","module","ace/lib/dom"],(s,r,t)=>{r.isDark=!0,r.cssClass="ace-nord-dark",s("../lib/dom").importCssString(r.cssText,r.cssClass)});window.ace.define("ace/theme/dawn",["require","exports","module","ace/lib/dom"],(s,r,t)=>{r.isDark=!1,r.cssClass="ace-dawn",s("../lib/dom").importCssString(r.cssText,r.cssClass)});const _e=f.forwardRef(({json:s,onChange:r,mode:t="code"},a)=>{const{theme:n}=Ie(),o={mode:t,onChangeText:r,statusBar:!1,mainMenuBar:!1,theme:n==="dark"?"ace/theme/nord_dark":"ace/theme/dawn"},c=f.useRef(null),l=f.useRef(null);return f.useEffect(()=>(l.current=new Sr(c.current,o),()=>{l.current&&l.current.destroy()}),[]),f.useEffect(()=>{l.current&&l.current.update(s)},[s]),e.jsx(i,{ref:a,border:"1px solid",borderColor:"gray.300",_dark:{borderColor:"gray.500"},borderRadius:5,h:"full",children:e.jsx(i,{height:"full",ref:c})})}),on=oe({name:N().min(1),address:N().min(1),port:pe().min(1).or(N().transform(s=>parseFloat(s))),api_port:pe().min(1).or(N().transform(s=>parseFloat(s))),xray_version:N().nullable().optional(),id:pe().nullable().optional(),status:wr(["connected","connecting","error","disabled"]).nullable().optional(),message:N().nullable().optional(),usage_coefficient:pe().or(N().transform(s=>parseFloat(s))),panel_client_cert:N().optional(),panel_client_key:N().optional()}),ln=["fetch-nodes-query-key"],sr=()=>{const{isEditingNodes:s}=R();return Ke({queryKey:ln,queryFn:Pe.getState().fetchNodes,refetchInterval:s?3e3:void 0,refetchOnWindowFocus:!1})},Pe=Ee((s,r)=>({nodes:[],addNode(t){return I.post("/node",t)},fetchNodes(){return I.get("/nodes")},fetchNodesUsage(t){return I.get("/nodes/usage",{query:t})},updateNode(t){return I.put(`/node/${t.id}`,t)},setDeletingNode(t){s({deletingNode:t})},reconnectNode(t){return I.post(`/node/${t.id}/reconnect`)},deleteNode:()=>I.delete(`/node/${r().deletingNode?.id}`)})),De=_r({placement:"bottom-end",pauseOnPageIdle:!0}),st=500,cn=St,dn=ze,un=Dr,hn=Tr,xn=s=>({[Ue.ReadyState.CONNECTING]:"connecting",[Ue.ReadyState.OPEN]:"connected",[Ue.ReadyState.CLOSING]:"closed",[Ue.ReadyState.CLOSED]:"closed",[Ue.ReadyState.UNINSTANTIATED]:"closed"})[s],gn=s=>{if(!s)return null;try{let r=new URL((void 0).startsWith("/")?window.location.origin+void 0:void 0);const t=`${r.pathname}/node/${s}/logs`.replace(/\/+/g,"/");return(r.protocol==="https:"?"wss://":"ws://")+r.host+t+"?interval=1&token="+Jt()}catch(r){return console.error("Unable to generate websocket url"),console.error(r),null}};let ne=[];const mn=()=>{const{data:s}=sr(),r=!1,[t,a]=f.useState(null),n=qe({defaultValues:{config:{}}}),{isEditingCore:o}=R(),{fetchCoreSettings:c,updateConfig:l,isLoading:x,config:d,isPostLoading:m,version:v,restartCore:g}=en(),S=f.useRef(null),[y,k]=f.useState([]),{t:U}=E(),u=f.useRef(!0),h=f.useCallback(wt(_=>{const D=Math.abs((S.current?.scrollTop||0)-(S.current?.scrollHeight||0)+(S.current?.offsetHeight||0))<10;S.current&&D?u.current=!0:u.current=!1,_.length<40&&k(_)},300),[]),{readyState:w}=Rr.useWebSocket(gn(t),{onMessage:_=>{ne.push(_.data),ne.length>st&&(ne=ne.splice(0,ne.length-st)),h([...ne])},shouldReconnect:()=>!0,reconnectAttempts:10,reconnectInterval:1e3});f.useEffect(()=>{S.current&&u.current&&(S.current.scrollTop=S.current?.scrollHeight)},[y]),f.useEffect(()=>()=>{ne=[]},[]);const j=xn(w.toString()),{mutate:z,isPending:W}=_t({mutationFn:g}),te=(_,D)=>{_!==t&&(a(_),k([]),ne=[])},J=({config:_})=>{l(_).then(()=>{De.create({title:U("core.successMessage"),type:"success",duration:3e3})}).catch(D=>{let Y=U("core.generalErrorMessage");typeof D.response._data.detail=="object"&&(Y=D.response._data.detail[Object.keys(D.response._data.detail)[0]]),typeof D.response._data.detail=="string"&&(Y=D.response._data.detail),De.create({title:Y,type:"error",duration:3e3})})},re=f.useRef(null),[G,ae]=f.useState(!1),Ce=()=>{document.fullscreenElement?(document.exitFullscreen(),ae(!1)):(re.current?.requestFullscreen(),ae(!0))};return f.useEffect(()=>{d&&n.setValue("config",d)},[d]),f.useEffect(()=>{o&&c()},[o]),e.jsxs("form",{onSubmit:n.handleSubmit(J),children:[e.jsxs(ce,{children:[e.jsxs(i,{children:[e.jsxs(b,{justifyContent:"space-between",alignItems:"flex-start",children:[e.jsxs(p,{as:"label",children:[U("core.configuration")," ",x&&e.jsx(i,{as:"span",display:"inline-block",w:"15px",h:"15px",border:"2px solid",borderColor:"currentColor",borderRadius:"full",borderTopColor:"transparent",animation:"spin 1s linear infinite"})]}),e.jsx(b,{gap:0,children:e.jsx(i,{as:"div",role:"tooltip","aria-label":"Panel Version",children:e.jsx(Re,{height:"100%",textTransform:"lowercase",children:v&&`v${v}`})})})]}),e.jsxs(i,{position:"relative",ref:re,minHeight:"300px",children:[e.jsx(X,{control:n.control,name:"config",render:({field:_})=>e.jsx(_e,{json:d,onChange:_.onChange})}),e.jsx(A,{size:"xs","aria-label":"full screen",variant:"ghost",position:"absolute",top:"2",right:"4",onClick:Ce,children:G?e.jsx(hn,{width:12,height:12}):e.jsx(un,{width:16,height:16})})]})]}),e.jsxs(i,{mt:"4",children:[e.jsxs(b,{justifyContent:"space-between",style:{paddingBottom:"1rem"},children:[e.jsxs(b,{children:[s?.[0]&&e.jsxs("select",{style:{width:"auto",backgroundColor:"transparent",padding:"0.5rem",borderRadius:"0.375rem",border:"1px solid var(--chakra-colors-gray-200)"},disabled:r,onChange:_=>te(_.currentTarget.value,_.currentTarget.selectedOptions[0].text),children:[e.jsx("option",{value:"",children:"Select a node to view logs"}),s&&s.map(_=>e.jsx("option",{value:String(_.id),children:U(_.name)},_.address))]}),e.jsx(p,{as:"label",className:"w-au",children:U("core.logs")})]}),e.jsx(p,{as:"label",children:U(`core.socket.${j}`)})]}),e.jsx(i,{border:"1px solid",borderColor:"gray.300",bg:"#F9F9F9",_dark:{borderColor:"gray.500",bg:"#2e3440"},borderRadius:5,minHeight:"200px",maxHeight:"250px",p:2,overflowY:"auto",ref:S,children:y.map((_,D)=>e.jsx(p,{fontSize:"xs",opacity:.8,whiteSpace:"pre-line",children:_},D))})]})]}),e.jsx(ve,{children:e.jsxs(b,{w:"full",justifyContent:"space-between",children:[e.jsx(b,{children:e.jsx(i,{children:e.jsxs(L,{size:"sm",onClick:()=>z(),children:[e.jsx(dn,{width:16,height:16,className:Ts({"animate-spin":W})}),U(W?"core.restarting":"core.restartCore")]})})}),e.jsx(b,{children:e.jsx(L,{size:"sm",variant:"solid",colorPalette:"primary",px:"5",type:"submit",disabled:x||m,loading:m,children:U("core.save")})})]})})]})},pn=()=>{const{isEditingCore:s}=R(),r=()=>R.setState({isEditingCore:!1}),{t}=E();return e.jsxs(q,{open:s,onOpenChange:a=>a.open||r(),children:[e.jsx(Q,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),e.jsxs(Z,{mx:"3",w:"full",children:[e.jsx(ie,{pt:6,children:e.jsxs(b,{gap:2,children:[e.jsx(se,{color:"primary",children:e.jsx(cn,{width:20,height:20,color:"white"})}),e.jsx(p,{fontWeight:"semibold",fontSize:"lg",children:t("core.title")})]})}),e.jsx(kr,{position:"absolute",right:"8px",top:"8px",onClick:r}),e.jsx(mn,{})]})]})},Cs=$(kt),fn=({open:s,onClose:r,user:t})=>{const{t:a}=E(),{deleteUser:n}=R(),[o,c]=f.useState(!1),l=async()=>{c(!0);try{await n(t),r()}finally{c(!1)}};return e.jsxs(q,{open:s,onOpenChange:x=>!x&&r(),placement:"center",children:[e.jsx(Q,{}),e.jsx(de,{children:e.jsxs(Z,{children:[e.jsx(ie,{children:a("deleteUser")}),e.jsx(ue,{}),e.jsx(ce,{children:e.jsxs(Ls,{i18nKey:"deleteUserConfirm",values:{account_number:t.account_number},children:["Are you sure you want to delete user",e.jsx("b",{children:t.account_number}),"?"]})}),e.jsxs(ve,{gap:2,children:[e.jsx(L,{variant:"outline",onClick:r,children:a("cancel")}),e.jsx(L,{colorPalette:"red",loading:o,onClick:l,children:a("delete")})]})]})})]})},jn=$(Lr),bn=$(Qe),tr=$(ze),vn=wt(s=>{R.getState().onFilterChange({...R.getState().filters,offset:0,search:s})},300),yn=({...s})=>{const{loading:r,filters:t,onFilterChange:a,refetchUsers:n,onCreateUser:o}=R(),{t:c}=E(),[l,x]=f.useState(""),d=v=>{x(v.target.value),vn(v.target.value)},m=()=>{x(""),a({...t,offset:0,search:""})};return e.jsxs(Rt,{id:"filters",templateColumns:{lg:"repeat(3, 1fr)",md:"repeat(4, 1fr)",base:"repeat(1, 1fr)"},position:"sticky",top:0,mx:"-6",px:"6",rowGap:4,gap:{lg:4,base:0},bg:"var(--chakra-colors-chakra-body-bg)",py:4,zIndex:"docked",...s,children:[e.jsx(Ae,{colSpan:{base:1,md:2,lg:1},order:{base:2,md:1},children:e.jsxs(i,{position:"relative",children:[e.jsx(H,{placeholder:c("search"),value:l,borderColor:"light-border",onChange:d,paddingLeft:"2.5rem",paddingRight:t.search&&t.search.length>0?"2.5rem":"1rem"}),e.jsx(i,{position:"absolute",left:"0.75rem",top:"50%",transform:"translateY(-50%)",pointerEvents:"none",children:e.jsx(jn,{w:4,h:4})}),(r||t.search&&t.search.length>0)&&e.jsx(i,{position:"absolute",right:"0.75rem",top:"50%",transform:"translateY(-50%)",children:e.jsxs(b,{children:[r&&e.jsx(Ne,{size:"xs"}),t.search&&t.search.length>0&&e.jsx(A,{onClick:m,"aria-label":"clear",size:"xs",variant:"ghost",children:e.jsx(bn,{w:4,h:4})})]})})]})}),e.jsx(Ae,{colSpan:2,order:{base:1,md:2},children:e.jsxs(b,{justifyContent:"flex-end",alignItems:"center",h:"full",children:[e.jsx(A,{"aria-label":"refresh users",disabled:r,onClick:n,size:"sm",variant:"outline",children:e.jsx(tr,{className:Ts({"animate-spin":r})})}),e.jsx(L,{colorScheme:"primary",size:"sm",onClick:()=>o(!0),px:5,children:c("createUser")})]})})]})},Cn="https://github.com/Gozargah/Marzban",Sn="https://github.com/Gozargah",rr=s=>{const{version:r}=R();return e.jsx(b,{w:"full",py:"0",position:"relative",...s,children:e.jsxs(p,{display:"inline-block",flexGrow:1,textAlign:"center",color:"gray.500",fontSize:"xs",children:[e.jsx(Ms,{color:"jade.solid",href:Cn,children:"Jade"}),r?` (v${r}), `:", ","Based on Marzban, Made with ❤️ in"," ",e.jsx(Ms,{color:"jade.solid",href:Sn,children:"Gozargah"})]})})},ar=({actions:s})=>{const{i18n:r}=E(),t=a=>{r.changeLanguage(a)};return e.jsxs(Dt,{children:[e.jsx(Tt,{asChild:!0,children:e.jsx(L,{size:"sm",variant:"outline","aria-label":"Change language",children:e.jsx(Ur,{width:16,height:16})})}),e.jsx(Lt,{children:e.jsx(Ar,{children:e.jsxs(Ut,{minW:"100px",zIndex:9999,children:[e.jsx(fe,{value:"en",onClick:()=>t("en"),children:"English"}),e.jsx(fe,{value:"fa",onClick:()=>t("fa"),children:"فارسی"}),e.jsx(fe,{value:"zh-cn",onClick:()=>t("zh-cn"),children:"简体中文"}),e.jsx(fe,{value:"ru",onClick:()=>t("ru"),children:"Русский"})]})})})]})},Fs="clientAuthToken",wn=()=>localStorage.getItem(Fs),_n=s=>{localStorage.setItem(Fs,s)},kn=()=>{localStorage.removeItem(Fs)},Ps=wn,Ss=_n,He=kn,Rn="/api/portal",Dn=yt.create({baseURL:Rn,async onResponseError(s){const r=s.response._data;throw console.error("[Client Portal API Error]",r),r}}),he=(s,r={})=>{const t=Ps(),a={};return r.headers&&Object.assign(a,r.headers),t&&(a.Authorization=`Bearer ${t}`),r.method&&["POST","PUT","PATCH"].includes(r.method.toUpperCase())&&r.body&&(a["Content-Type"]||r.body instanceof URLSearchParams||r.body instanceof FormData||(a["Content-Type"]="application/json")),Dn(s,{...r,headers:a})},Tn=()=>he("/register",{method:"POST"}),nr=s=>he("/login",{method:"POST",body:{account_number:s}}),ws=()=>he("/account"),or=()=>he("/account/plans"),lr=()=>he("/servers"),ir=s=>he("/create-checkout-session",{method:"POST",body:{plan_id:s}}),cr=s=>he("/account/activate",{method:"POST",body:{plan_id:s}}),dr=()=>he("/logout",{method:"POST"}),Ln=s=>Fe.get(`/nodes/${s}/services/`),Un=(s,r)=>Fe.post(`/nodes/${s}/services/`,r),tt=(s,r,t)=>Fe.put(`/nodes/${s}/services/${r}`,t),An=(s,r)=>Fe.delete(`/nodes/${s}/services/${r}`);Ee(Ct((s,r)=>({clientToken:null,clientDetails:null,plans:[],servers:[],isLoadingAuth:!1,isLoadingDetails:!1,isLoadingPlans:!1,isLoadingServers:!1,isLoadingPayment:!1,error:null,isAuthenticated:()=>!!r().clientToken&&!!r().clientDetails,getActiveNode:()=>r().clientDetails?.active_node||null,getAvailableNodes:()=>r().clientDetails?.available_nodes||[],getCurrentPlan:()=>{const t=r().clientDetails;return t?.user.xray_user&&r().plans.find(a=>a.id===t.user.xray_user?.account_number)||null},initializeAuth:()=>{const t=Ps();t&&(s({clientToken:t}),r().fetchClientDetails().catch(a=>{console.error("Failed to fetch client details on init:",a),r().logout()}))},login:async t=>{s({isLoadingAuth:!0,error:null});try{const a=await nr(t);return Ss(a.access_token),s({clientToken:a.access_token,isLoadingAuth:!1}),await r().fetchClientDetails(),!0}catch(a){return console.error("Client login failed:",a),He(),s({isLoadingAuth:!1,error:a.detail||"Login failed. Please check account number.",clientToken:null,clientDetails:null}),!1}},logout:async()=>{try{await dr()}catch(t){console.error("Logout API call failed:",t)}finally{He(),s({clientToken:null,clientDetails:null,plans:[],servers:[],error:null})}},fetchClientDetails:async()=>{if(r().clientToken){s({isLoadingDetails:!0,error:null});try{const t=await ws();s({clientDetails:t,isLoadingDetails:!1})}catch(t){console.error("Failed to fetch client details:",t),(t.status===401||t.status===403)&&r().logout(),s({isLoadingDetails:!1,error:t.detail||"Failed to load account details."})}}},fetchPlans:async()=>{s({isLoadingPlans:!0,error:null});try{const t=await or();s({plans:t,isLoadingPlans:!1})}catch(t){console.error("Failed to fetch plans:",t),s({isLoadingPlans:!1,error:t.detail||"Failed to load plans."})}},fetchServers:async()=>{if(r().clientToken){s({isLoadingServers:!0,error:null});try{const t=await lr();s({servers:t,isLoadingServers:!1})}catch(t){console.error("Failed to fetch servers:",t),(t.status===401||t.status===403)&&r().logout(),s({isLoadingServers:!1,error:t.detail||"Failed to load servers."})}}},initiateStripeCheckout:async t=>{if(!r().isAuthenticated())return s({error:"Please login to proceed with payment."}),null;s({isLoadingPayment:!0,error:null});try{const a=await ir(t);return s({isLoadingPayment:!1}),a.url?a:a.error?(s({error:a.error}),null):a}catch(a){return console.error("Stripe checkout initiation failed:",a),s({isLoadingPayment:!1,error:a.detail||"Payment initiation failed."}),null}},activatePlanDirectly:async t=>{if(!r().isAuthenticated())return s({error:"Please login to activate a plan."}),null;s({isLoadingPayment:!0,error:null});try{const a=await cr(t);return await r().fetchClientDetails(),s({isLoadingPayment:!1}),a.user}catch(a){return console.error("Direct plan activation failed:",a),s({isLoadingPayment:!1,error:a.detail||"Plan activation failed."}),null}},clearError:()=>s({error:null})})));const En=Ee()((s,r)=>({isAuthenticated:!1,isLoadingAuth:!1,error:null,initializeAuth:async()=>{if(!Ps()){s({isAuthenticated:!1});return}s({isLoadingAuth:!0});try{await ws(),s({isAuthenticated:!0})}catch{He(),s({isAuthenticated:!1})}finally{s({isLoadingAuth:!1})}},register:async()=>{s({isLoadingAuth:!0,error:null});try{const t=await Tn();return Ss(t.access_token),s({isAuthenticated:!0}),await r().fetchClientDetails(),!0}catch(t){throw s({error:"Failed to register account"}),t}finally{s({isLoadingAuth:!1})}},login:async t=>{s({isLoadingAuth:!0,error:null});try{const a=await nr(t);Ss(a.access_token),s({isAuthenticated:!0}),await r().fetchClientDetails()}catch(a){throw s({error:"Invalid account number"}),a}finally{s({isLoadingAuth:!1})}},logout:async()=>{try{await dr()}catch(t){console.error("Logout failed:",t)}finally{He(),s({isAuthenticated:!1,clientDetails:null})}},clientDetails:null,isLoadingDetails:!1,fetchClientDetails:async()=>{s({isLoadingDetails:!0});try{const t=await ws();s({clientDetails:t})}catch(t){throw s({error:"Failed to fetch client details"}),t}finally{s({isLoadingDetails:!1})}},plans:[],isLoadingPlans:!1,fetchPlans:async()=>{s({isLoadingPlans:!0});try{const t=await or();s({plans:t})}catch(t){throw s({error:"Failed to fetch plans"}),t}finally{s({isLoadingPlans:!1})}},initiateStripeCheckout:async t=>{try{return await ir(t)}catch(a){throw s({error:"Failed to initiate checkout"}),a}},activatePlanDirectly:async t=>{try{await cr(t),await r().fetchClientDetails()}catch(a){throw s({error:"Failed to activate plan"}),a}},servers:[],isLoadingServers:!1,fetchServers:async()=>{s({isLoadingServers:!0});try{const t=await lr();s({servers:t})}catch(t){throw s({error:"Failed to fetch servers"}),t}finally{s({isLoadingServers:!1})}}})),In=()=>(En(),Ke({queryKey:["user"],queryFn:()=>I.get("/api/user")})),ye=s=>$(s),zn=ye(Er),Nn=ye(Ir),Fn=ye(St),Pn=ye(zr),Wn=ye(Nr),$n=ye(Ge),On=ye(At),Mn=()=>{const{data:s,isSuccess:r,isPending:t}=In(),a=!t&&r&&s?.is_sudo,{onResetAllUsage:n,onShowingNodesUsage:o}=R(),{t:c}=E(),{theme:l,setTheme:x}=Ie();return e.jsxs(b,{gap:2,justify:"space-between",position:"relative",children:[e.jsx(p,{as:"h1",fontWeight:"semibold",fontSize:"2xl",children:c("admin.users")}),e.jsx(i,{overflow:"auto",css:{direction:"rtl"},children:e.jsxs(b,{align:"center",children:[e.jsxs(Dt,{children:[e.jsx(Tt,{asChild:!0,children:e.jsx(A,{size:"sm",variant:"outline","aria-label":"settings",children:e.jsx(Pn,{})})}),e.jsxs(Ut,{minW:"170px",zIndex:9999,className:"menuList",children:[a&&e.jsxs(e.Fragment,{children:[e.jsx(fe,{value:"nodes-usage",onClick:()=>o(!0),fontSize:"sm",maxW:"170px",children:e.jsxs(b,{children:[e.jsx($n,{}),e.jsx(p,{children:c("header.nodesUsage")})]})}),e.jsx(fe,{value:"reset-usage",onClick:()=>n(!0),fontSize:"sm",maxW:"170px",children:e.jsxs(b,{children:[e.jsx(On,{}),e.jsx(p,{children:c("resetAllUsage")})]})})]}),e.jsx(Fr,{to:"/login",children:e.jsx(fe,{value:"logout",fontSize:"sm",maxW:"170px",children:e.jsxs(b,{children:[e.jsx(Wn,{}),e.jsx(p,{children:c("header.logout")})]})})})]})]}),a&&e.jsx(A,{size:"sm",variant:"outline","aria-label":"core settings",onClick:()=>R.setState({isEditingCore:!0}),children:e.jsx(Fn,{})}),e.jsx(ar,{}),e.jsx(A,{size:"sm",variant:"outline","aria-label":"switch theme",onClick:()=>{const d=l==="dark"?"light":"dark";Zt(d),x(d)},children:l==="light"?e.jsx(zn,{}):e.jsx(Nn,{})})]})})]})};function Bn(s){const r=360/s,t=90,a=47,n=[];for(let o=0;o<s;o++){const c=o*r%360+140,l=Hn(c,t,a);n.push(l)}return n}function Hn(s,r,t){s/=360,r/=100,t/=100;let a,n,o;if(r===0)a=n=o=t;else{const l=(m,v,g)=>(g<0&&(g+=1),g>1&&(g-=1),g<.16666666666666666?m+(v-m)*6*g:g<.5?v:g<.6666666666666666?m+(v-m)*(.6666666666666666-g)*6:m),x=t<.5?t*(1+r):t+r-t*r,d=2*t-x;a=Math.round(l(d,x,s+1/3)*255),n=Math.round(l(d,x,s)*255),o=Math.round(l(d,x,s-1/3)*255)}const c=l=>{const x=l.toString(16);return x.length===1?"0"+x:x};return`#${c(a)}${c(n)}${c(o)}`}const Vn=(s,r)=>{f.useEffect(()=>{const t=a=>{!s.current||s.current.contains(a.target)||r()};return document.addEventListener("mousedown",t),document.addEventListener("touchstart",t),()=>{document.removeEventListener("mousedown",t),document.removeEventListener("touchstart",t)}},[s,r])},rt=({border:s,...r})=>{const t=ke({base:"xs",md:"sm"});return e.jsx(i,{as:"label",children:e.jsx(i,{minW:"48px",w:"full",h:"full",textAlign:"center",cursor:"pointer",fontSize:t,borderWidth:s?"1px":"0px",borderRadius:"md",_checked:{bg:"primary.500",color:"white",borderColor:"primary.500"},_focus:{boxShadow:"outline"},px:3,py:1,...r,children:r.children})})},ur=({onChange:s,defaultValue:r,...t})=>{const{t:a,i18n:n}=E(),{theme:o}=Ie(),c=ke({base:["7h","1d","3d","1w"],md:["7h","1d","3d","1w","1m","3m"]}),l={h:"hour",d:"day",w:"week",m:"month",y:"year"},x=ke({base:[{title:"hours",options:["1h","3h","6h","12h"]},{title:"days",options:["1d","2d","3d","4d"]},{title:"weeks",options:["1w","2w","3w","4w"]},{title:"months",options:["1m","2m","3m","6m"]}],md:[{title:"hours",options:["1h","2h","3h","6h","8h","12h"]},{title:"days",options:["1d","2d","3d","4d","5d","6d"]},{title:"weeks",options:["1w","2w","3w","4w"]},{title:"months",options:["1m","2m","3m","6m","8m"]}]}),[d,m]=f.useState(r),v=_=>{const D=_.value;if(!D||D==="custom")return;y(),c.indexOf(D)>=0?(u(a("userDialog.custom")),w(!1)):(u(a("userDialog.custom")+` (${D})`),w(!0));const Y=Number(D.substring(0,D.length-1)),Te=l[D[D.length-1]];s(D,{start:P().utc().subtract(Y,Te).format("YYYY-MM-DDTHH:00:00")}),m(D)},{open:g,onOpen:S,onClose:y}=Us(),k=f.useRef(null);Vn(k,y);const[U,u]=f.useState(a("userDialog.custom")),[h,w]=f.useState(!1),[j,z]=f.useState(0),W=ke({base:1,md:2}),te=ke({base:"xs",md:"sm"}),[J,re]=f.useState(null),[G,ae]=f.useState(null),Ce=_=>{const[D,Y]=_;G&&!Y?(re(null),ae(null)):(re(D),ae(Y),D&&Y&&(y(),s("custom",{start:P(D).format("YYYY-MM-DDT00:00:00"),end:P(Y).format("YYYY-MM-DDT23:59:59")})))};return e.jsxs(F,{...t,children:[j==0&&e.jsxs(Pr,{gap:0,display:"flex",borderWidth:"1px",borderRadius:"md",minW:{base:"320px",md:"400px"},children:[e.jsx(Bs,{value:d,onValueChange:v,children:c.map(_=>e.jsx(rt,{value:_,children:_},_))}),e.jsx(i,{onClick:()=>{re(null),ae(null),S()},cursor:"pointer",borderRadius:"md",w:"full",fontSize:te,px:3,py:1,bg:h?"primary.500":"unset",color:h?"white":"unset",borderColor:h?"primary.500":"unset",children:e.jsxs(b,{children:[e.jsx(p,{children:U}),e.jsx(se,{as:Hs,boxSize:"18px"})]})})]}),j==1&&e.jsxs(b,{onClick:S,cursor:"pointer",fontSize:te,borderRadius:"md",px:3,py:1,minW:{base:"320px",md:"400px"},borderWidth:"1px",children:[e.jsx(p,{w:"full",color:J?"unset":"gray.500",children:J?P(J).format("YYYY-MM-DD (00:00)"):a("userDialog.startDate")}),e.jsx(se,{as:Et,boxSize:"18px"}),e.jsx(p,{w:"full",color:G?"unset":"gray.500",children:G?P(G).format("YYYY-MM-DD (23:59)"):a("userDialog.endDate")}),e.jsx(se,{as:Hs,boxSize:"18px"})]}),e.jsx(F,{ref:k,marginTop:"40px !important",borderRadius:"md",borderWidth:"1px",position:"absolute",zIndex:"1",backgroundColor:"white",_dark:{backgroundColor:"gray.700"},display:g?"unset":"none",children:e.jsxs(As,{defaultValue:j===0?"relative":"absolute",onValueChange:_=>z(_.value==="relative"?0:1),children:[e.jsxs(Es,{children:[e.jsx(je,{value:"relative",children:"Relative"}),e.jsx(je,{value:"absolute",children:"Absolute"})]}),e.jsx(be,{value:"relative",children:x.map(_=>e.jsx(F,{alignItems:"start",pl:2,pr:2,children:e.jsxs(b,{justifyItems:"flex-start",mb:4,children:[e.jsx(p,{fontSize:te,minW:"60px",children:a("userDialog."+_.title)}),e.jsx(Bs,{value:d,onValueChange:v,children:_.options.map(D=>e.jsx(rt,{border:!0,value:D,children:D},D+".custom"))})]})},_.title))}),e.jsx(be,{value:"absolute",children:e.jsx(F,{children:e.jsx(It,{locale:n.language.toLocaleLowerCase(),selected:J,onChange:Ce,startDate:J,endDate:G,selectsRange:!0,maxDate:new Date,monthsShown:W,peekNextMonth:!1,inline:!0})})})]})})]})};function Ve(s,r=[],t=[]){const a=K(Array.isArray(r)?r.reduce((n,o)=>n+=o,0):0);return{series:r,options:{labels:t,chart:{width:"100%",height:"100%",type:"donut",animations:{enabled:!1}},title:{text:`${s}${a}`,align:"center",style:{fontWeight:"var(--chakra-fontWeights-medium)",color:"var(--chakra-colors-gray-300)"}},legend:{position:"bottom",labels:{colors:"#CBD5E0",useSeriesColors:!1}},stroke:{width:1,colors:void 0},dataLabels:{formatter:(n,{seriesIndex:o,w:c})=>K(c.config.series[o],1)},tooltip:{custom:({series:n,seriesIndex:o,dataPointIndex:c,w:l})=>{const x=K(n[o],1),d=Math.max(n.reduce((v,g)=>v+=g),1),m=Math.round(n[o]/d*1e3)/10+"%";return`
            <div style="
                    background-color: ${l.globals.colors[o]};
                    padding-left:12px;
                    padding-right:12px;
                    padding-top:6px;
                    padding-bottom:6px;
                    font-size:0.725rem;
                  "
            >
              ${l.config.labels[o]}: <b>${m}, ${x}</b>
            </div>
          `}},colors:Bn(r.length)}}}const Yn=$(Ge),Kn=()=>{const{t:s}=E(),{isShowingNodesUsage:r,onShowingNodesUsage:t}=R(),a=()=>{t(!1),m("1m")},{theme:n}=Ie(),{fetchNodesUsage:o}=Pe(),c=s("userDialog.total"),[l,x]=f.useState(Ve(c)),[d,m]=f.useState("1m"),[v,g]=f.useState(!1),S=async y=>{g(!0);try{const k=await o(y),U=Object.values(k.usages).map(h=>h.uplink+h.downlink),u=Object.values(k.usages).map(h=>h.node_name);x(Ve(c,U,u))}finally{g(!1)}};return f.useEffect(()=>{r&&S({start:P().utc().subtract(30,"day").format("YYYY-MM-DDTHH:00:00")})},[r]),e.jsxs(q,{open:r,onOpenChange:a,children:[e.jsx(Q,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),e.jsxs(Z,{mx:"3",w:"full",maxW:"2xl",children:[e.jsx(ie,{pt:6,children:e.jsxs(b,{gap:2,children:[e.jsx(se,{color:"primary",children:e.jsx(Yn,{w:5,h:5,color:"white"})}),e.jsx(p,{fontWeight:"semibold",fontSize:"lg",children:s("header.nodesUsage")})]})}),e.jsx(ue,{asChild:!0,children:e.jsx(A,{"aria-label":"close",size:"sm",variant:"ghost",pos:"absolute",top:"3",right:"3",disabled:v,children:e.jsx("span",{children:"×"})})}),e.jsx(ce,{children:e.jsxs(F,{gap:4,children:[e.jsx(ur,{defaultValue:d,onChange:(y,k)=>{m(y),S(k)}}),e.jsx(i,{w:"full",maxW:"300px",mt:4,children:e.jsx(f.Suspense,{fallback:e.jsx(Ne,{}),children:e.jsx(zt,{options:l.options,series:l.series,type:"donut",height:500})})})]})}),e.jsx(ve,{})]})]})},Gn=()=>{const{QRcodeLinks:s,setQRCode:r,setSubLink:t,subscribeUrl:a}=R(),{t:n}=E(),[o,c]=f.useState(0),l=s!==null,x=()=>{r(null),t(null)},d=String(a).startsWith("/")?window.location.origin+a:String(a),m=g=>e.jsx(A,{...g,"aria-label":"next",size:"sm",pos:"absolute",right:"-4",top:"50%",transform:"translateY(-50%)",children:e.jsx(Et,{className:"h-6 w-6 text-gray-600 dark:text-white"})}),v=g=>e.jsx(A,{...g,"aria-label":"previous",size:"sm",pos:"absolute",left:"-4",top:"50%",transform:"translateY(-50%)",children:e.jsx($r,{className:"h-6 w-6 text-gray-600 dark:text-white"})});return e.jsxs(q,{open:l,onOpenChange:g=>!g.open&&x(),children:[e.jsx(Q,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),e.jsx(de,{children:e.jsxs(Z,{mx:"3",w:"fit-content",maxW:"3xl",children:[e.jsxs(b,{pt:6,px:6,gap:3,children:[e.jsx(se,{color:"primary",children:e.jsx(Nt,{className:"h-5 w-5 text-white"})}),e.jsx(i,{flex:"1"}),e.jsx(ue,{asChild:!0,children:e.jsx(A,{"aria-label":n("close"),size:"sm",variant:"ghost",children:e.jsx(Qe,{className:"h-4 w-4"})})})]}),s&&e.jsxs(i,{display:"flex",flexDir:{base:"column",lg:"row"},justifyContent:"center",gap:{base:8,lg:16},px:{base:12,lg:0},py:8,children:[a&&e.jsxs(F,{children:[e.jsx(Vs,{value:d,size:300,includeMargin:!1,level:"L",style:{background:"white",padding:"8px"}}),e.jsx(p,{textAlign:"center",pt:1,children:n("qrcodeDialog.sublink")})]}),e.jsxs(i,{w:"300px",pos:"relative",children:[e.jsx(Wr,{arrows:!0,dots:!1,infinite:!0,slidesToShow:1,slidesToScroll:1,afterChange:c,nextArrow:e.jsx(m,{}),prevArrow:e.jsx(v,{}),children:s.map((g,S)=>e.jsx(b,{justify:"center",children:e.jsx(Vs,{value:g,size:300,includeMargin:!1,level:"L",style:{background:"white",padding:"8px"}})},S))}),e.jsxs(p,{textAlign:"center",pt:3,children:[o+1," / ",s.length]})]})]})]})})]})},qn=()=>{const[s,r]=f.useState(!1),{isResetingAllUsage:t,onResetAllUsage:a,resetAllUsage:n}=R(),{t:o}=E(),c=()=>{a(!1)},l=()=>{r(!0),n().then(()=>{De.create({title:o("resetAllUsage.success"),type:"success",closable:!0,duration:3e3})}).catch(()=>{De.create({title:o("resetAllUsage.error"),type:"error",closable:!0,duration:3e3})}).finally(()=>{r(!1)})};return e.jsxs(q,{open:t,onOpenChange:x=>!x.open&&c(),children:[e.jsx(Q,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),e.jsx(de,{children:e.jsxs(Z,{mx:"3",children:[e.jsx(ie,{pt:6,children:e.jsx(se,{color:"red",children:e.jsx(At,{className:"w-5 h-5"})})}),e.jsx(ue,{asChild:!0,children:e.jsx(A,{"aria-label":"close",size:"sm",variant:"ghost",mt:3,children:e.jsx(Qe,{className:"w-4 h-4"})})}),e.jsxs(ce,{children:[e.jsx(p,{fontWeight:"semibold",fontSize:"lg",children:o("resetAllUsage.title")}),t&&e.jsx(p,{mt:1,fontSize:"sm",_dark:{color:"gray.400"},color:"gray.600",children:o("resetAllUsage.prompt")})]}),e.jsxs(ve,{display:"flex",children:[e.jsx(L,{size:"sm",onClick:c,mr:3,w:"full",variant:"outline",children:o("cancel")}),e.jsx(L,{size:"sm",w:"full",colorPalette:"red",onClick:l,loading:s,children:o("reset")})]})]})})]})},Qn=()=>e.jsx(ze,{className:"w-5 h-5"}),Zn=({open:s,onClose:r,user:t})=>{const{t:a}=E(),{resetUserUsage:n}=R(),[o,c]=f.useState(!1),l=async()=>{c(!0);try{await n(t.account_number),r()}catch(x){console.error(x)}finally{c(!1)}};return e.jsxs(q,{open:s,onOpenChange:x=>!x.open&&r(),role:"alertdialog",children:[e.jsx(Q,{}),e.jsx(de,{children:e.jsxs(Z,{children:[e.jsxs(ie,{p:6,borderBottomWidth:"1px",children:[e.jsx(p,{fontWeight:"semibold",fontSize:"lg",children:a("resetUserUsage")}),e.jsx(ue,{asChild:!0,children:e.jsx("button",{"aria-label":a("close"),className:"absolute top-4 end-4",children:e.jsx(Qe,{className:"w-4 h-4"})})})]}),e.jsx(ce,{p:6,children:e.jsx(p,{children:a("resetUserUsageConfirm",{account_number:t.account_number})})}),e.jsxs(ve,{p:4,gap:3,display:"flex",justifyContent:"flex-end",borderTopWidth:"1px",children:[e.jsx(L,{variant:"ghost",onClick:r,size:"sm",children:a("cancel")}),e.jsxs(L,{colorPalette:"primary",size:"sm",onClick:l,loading:o,children:[e.jsx(Qn,{}),a("reset")]})]})]})})]})},Jn=$(ze),Xn=({open:s,onClose:r,user:t})=>{const{t:a}=E(),{revokeSubscription:n}=R(),[o,c]=f.useState(!1),l=async()=>{c(!0);try{await n(t),r()}finally{c(!1)}};return e.jsxs(q,{open:s,onOpenChange:x=>!x&&r(),placement:"center",children:[e.jsx(Q,{}),e.jsx(de,{children:e.jsxs(Z,{children:[e.jsxs(ie,{children:[e.jsx(Jn,{w:5,h:5,me:2}),a("revokeSubscription")]}),e.jsx(ue,{}),e.jsx(ce,{children:e.jsx(p,{children:e.jsxs(Ls,{i18nKey:"revokeSubscriptionConfirm",values:{account_number:t.account_number},children:["Are you sure you want to revoke the subscription for user",e.jsx("b",{children:t.account_number}),"?"]})})}),e.jsxs(ve,{gap:2,children:[e.jsx(L,{variant:"ghost",onClick:r,children:a("cancel")}),e.jsx(L,{colorPalette:"primary",onClick:l,loading:o,children:a("revoke")})]})]})})]})},Je=s=>{let r={status:"",time:""};if(s){P(s*1e3).utc().isAfter(P().utc())?r.status="expires":r.status="expired";const t=[],a=P.duration(P(s*1e3).utc().diff(P()));a.years()!=0&&t.push(Math.abs(a.years())+" year"+(Math.abs(a.years())!=1?"s":"")),a.months()!=0&&t.push(Math.abs(a.months())+" month"+(Math.abs(a.months())!=1?"s":"")),a.days()!=0&&t.push(Math.abs(a.days())+" day"+(Math.abs(a.days())!=1?"s":"")),t.length===0&&(a.hours()!=0&&t.push(Math.abs(a.hours())+" hour"+(Math.abs(a.hours())!=1?"s":"")),a.minutes()!=0&&t.push(Math.abs(a.minutes())+" min"+(Math.abs(a.minutes())!=1?"s":""))),r.time=t.join(", ")}return r},ee={ACTIVE:"active",DISABLED:"disabled",LIMITED:"limited",EXPIRED:"expired",ON_HOLD:"on_hold"},me={NO_RESET:"no_reset",DAY:"day",WEEK:"week",MONTH:"month"},hr=[{title:"vless",description:"VLESS Protocol"},{title:"vmess",description:"VMess Protocol"},{title:"trojan",description:"Trojan Protocol"},{title:"shadowsocks",description:"Shadowsocks Protocol"}],as=s=>{if(!s)return;const r={};return s.forEach((t,a)=>{r[a]=t.map(({tag:n})=>({tag:n}))}),r},ns=s=>{const r={};return s&&Object.keys(s).forEach(t=>{r[t]=s[t].map(a=>a.tag)}),{selected_proxies:[],data_limit:0,expire:null,account_number:"",data_limit_reset_strategy:me.NO_RESET,status:ee.ACTIVE,on_hold_expire_duration:null,note:"",inbounds:r,proxies:{vless:{id:"",flow:""},vmess:{id:""},trojan:{password:""},shadowsocks:{password:"",method:"chacha20-ietf-poly1305"}}}},eo=s=>({...s,status:s.status,data_limit_reset_strategy:s.data_limit_reset_strategy,data_limit:s.data_limit?parseFloat((s.data_limit/1073741824).toFixed(5)):0,on_hold_expire_duration:s.on_hold_expire_duration?s.on_hold_expire_duration/86400:0,selected_proxies:Object.keys(s.proxies??{}),proxies:{vless:{id:s.proxies?.vless?.id??"",flow:s.proxies?.vless?.flow??""},vmess:{id:s.proxies?.vmess?.id??""},trojan:{password:s.proxies?.trojan?.password??""},shadowsocks:{password:s.proxies?.shadowsocks?.password??"",method:s.proxies?.shadowsocks?.method??"chacha20-ietf-poly1305"}},inbounds:s.inbounds??{},note:s.note??null}),so=(s,r)=>{const t={};return s.forEach(a=>{if(hr.find(({title:n})=>n===a))switch(a){case"vless":t.vless={id:"",flow:""};break;case"vmess":t.vmess={id:""};break;case"trojan":t.trojan={password:""};break;case"shadowsocks":t.shadowsocks={password:"",method:"chacha20-ietf-poly1305"};break}}),r&&s.forEach(a=>{r[a]&&(t[a]=r[a])}),t},to=oe({account_number:N().min(1,"Required"),selected_proxies:Gs(N()),note:N().nullable(),proxies:oe({vless:oe({id:N(),flow:N()}),vmess:oe({id:N()}),trojan:oe({password:N()}),shadowsocks:oe({password:N(),method:N()})}),data_limit:Ys(s=>s===""||s==null?null:Number(s),pe().positive("Must be positive").nullable()).transform(s=>s!=null?Math.round(s*1073741824):0),expire:pe().nullable(),data_limit_reset_strategy:Ks(me),inbounds:Or(N(),Gs(N())),status:Ks(ee),on_hold_expire_duration:Ys(s=>s===""||s==null?null:Number(s),pe().min(.1,"Required").nullable()).transform(s=>s!=null?Math.round(s*86400):null)}),ro=()=>{const{editingUser:s,isCreatingNewUser:r,onCreateUser:t,editUser:a,fetchUserUsage:n,onEditingUser:o,createUser:c,onDeletingUser:l,inbounds:x}=R(),{t:d,i18n:m}=E(),{theme:v}=Ie(),g=!!s,S=r||g,y=qe({defaultValues:ns(as(x)),resolver:Is(to)}),[k,U]=f.useState(!1),[u,h]=f.useState(null),[w,j]=Mr({control:y.control,name:["data_limit","status"]}),z=j===ee.ON_HOLD,W=d("userDialog.total"),[te,J]=f.useState(Ve(W,[],[])),[re,G]=f.useState(!1),[ae,Ce]=f.useState("1m"),_=C=>{s&&n(s,C).then(T=>{const Le=T.usages?Object.keys(T.usages):[],xe=T.usages?Object.values(T.usages).map($s=>$s.used_traffic):[];J(Ve(v??"light",W,[xe,Le]))}).catch(console.error)};f.useEffect(()=>{s?(y.reset(eo(s)),_({start:P().utc().subtract(30,"day").format("YYYY-MM-DDTHH:00:00Z")})):y.reset(ns(as(x)))},[s,x]);const D=()=>y.setValue("account_number",crypto.randomUUID()),Y=C=>{U(!0),h(null);const{selected_proxies:T,...Le}=C,xe={...Le,proxies:so(T,C.proxies),data_limit_reset_strategy:C.data_limit&&C.data_limit>0?C.data_limit_reset_strategy:me.NO_RESET,note:C.note??""};(g?a(xe):c(xe)).then(()=>De.create({title:d(g?"userDialog.userEdited":"userDialog.userCreated",{username:C.account_number}),type:"success",duration:3e3})).then(Te).catch(Xe=>{const Se=Xe?.response?._data?.detail??Xe?.message??"Unknown error";h(typeof Se=="string"?Se:JSON.stringify(Se)),Xe?.response?.status===422&&typeof Se=="object"&&Object.keys(Se).forEach(Os=>y.setError(Os,{type:"custom",message:Se[Os]}))}).finally(()=>U(!1))},Te=()=>{y.reset(ns(as(x))),h(null),G(!1),Ce("1m"),t(!1),o(null)},Ws=[{label:d("userDialog.resetStrategy.noReset"),value:me.NO_RESET},{label:d("userDialog.resetStrategy.day"),value:me.DAY},{label:d("userDialog.resetStrategy.week"),value:me.WEEK},{label:d("userDialog.resetStrategy.month"),value:me.MONTH}],xr=Ft({items:Ws});return e.jsx(q,{open:S,onOpenChange:C=>!C.open&&Te(),children:e.jsxs(Lt,{children:[e.jsx(Q,{}),e.jsx(de,{children:e.jsxs(Z,{children:[e.jsx(i,{pt:6,px:6,children:e.jsxs(b,{gap:2,children:[e.jsx(se,{color:"primary",children:g?e.jsx(zs,{className:"w-5 h-5"}):e.jsx(Br,{className:"w-5 h-5"})}),e.jsx(Hr,{asChild:!0,children:e.jsx(p,{fontWeight:"semibold",fontSize:"lg",children:d(g?"userDialog.editUserTitle":"createNewUser")})}),e.jsx(i,{flex:"1"}),e.jsx(ue,{asChild:!0,children:e.jsx(A,{"aria-label":d("close"),size:"sm",variant:"ghost",disabled:k,children:e.jsx(Cs,{})})})]})}),e.jsx(i,{px:6,py:4,children:e.jsx(Vr,{...y,children:e.jsxs("form",{onSubmit:y.handleSubmit(Y),children:[e.jsxs(Rt,{templateColumns:{base:"1fr",md:"repeat(2,1fr)"},gap:3,children:[e.jsx(Ae,{children:e.jsxs(F,{gap:3,align:"stretch",children:[e.jsxs(Yr,{gap:3,wrap:"wrap",children:[e.jsxs(O,{flex:"1",children:[e.jsx(M,{children:d("accountNumber")}),e.jsxs(b,{children:[e.jsx(H,{...y.register("account_number"),size:"sm",borderRadius:"6px",disabled:k||g}),!g&&e.jsx(A,{size:"xs",variant:"ghost","aria-label":d("random"),onClick:D,disabled:k,children:e.jsx(ze,{className:"h-4 w-4"})})]}),e.jsx(ge,{children:y.formState.errors.account_number?.message})]}),g?e.jsxs(O,{children:[e.jsx(M,{mr:"2",children:d("status.active")}),e.jsx(X,{name:"status",control:y.control,render:({field:C})=>e.jsx(cs,{checked:C.value===ee.ACTIVE,onCheckedChange:T=>C.onChange(T?ee.ACTIVE:ee.DISABLED),disabled:k,children:e.jsx(qs,{})})})]}):e.jsxs(O,{children:[e.jsx(M,{whiteSpace:"nowrap",children:d("userDialog.onHold")}),e.jsx(X,{name:"status",control:y.control,render:({field:C})=>e.jsx(cs,{checked:C.value===ee.ON_HOLD,onCheckedChange:T=>C.onChange(T?ee.ON_HOLD:ee.ACTIVE),disabled:k,children:e.jsx(qs,{})})})]})]}),e.jsxs(O,{children:[e.jsx(M,{children:d("userDialog.dataLimit")}),e.jsx(X,{name:"data_limit",control:y.control,render:({field:C})=>e.jsx(Qs,{endAddon:"GB",children:e.jsx(H,{...C,type:"number",size:"sm",borderRadius:"6px",onChange:T=>C.onChange(T.target.value===""?null:Number(T.target.value)),value:C.value==null||C.value===0?"":String(C.value),disabled:k})})}),e.jsx(ge,{children:y.formState.errors.data_limit?.message})]}),e.jsx(Pt,{open:typeof w=="number"&&w>0,children:e.jsx(Wt,{children:e.jsxs(O,{children:[e.jsx(M,{children:d("userDialog.periodicUsageReset")}),e.jsx(X,{name:"data_limit_reset_strategy",control:y.control,render:({field:C})=>e.jsxs($t,{collection:xr,value:C.value?[C.value]:[],onValueChange:T=>C.onChange(T.value[0]),disabled:k,children:[e.jsx(Ot,{borderRadius:"6px",children:e.jsx(Kr,{placeholder:d("userDialog.selectResetStrategy")})}),e.jsx(Mt,{children:e.jsx(Bt,{children:Ws.map(T=>e.jsx(Ht,{item:T,children:T.label},T.value))})})]})})]})})}),e.jsxs(O,{children:[e.jsx(M,{children:d(z?"userDialog.onHoldExpireDuration":"userDialog.expiryDate")}),z?e.jsx(X,{name:"on_hold_expire_duration",control:y.control,render:({field:C})=>e.jsx(Qs,{endAddon:"Days",children:e.jsx(H,{...C,type:"number",size:"sm",borderRadius:"6px",disabled:k,onChange:T=>C.onChange(T.target.value===""?null:Number(T.target.value)),value:C.value==null?"":String(C.value)})})}):e.jsx(X,{name:"expire",control:y.control,render:({field:C})=>{const{status:T,time:Le}=Je(C.value);return e.jsxs(e.Fragment,{children:[e.jsx(It,{selected:C.value?P.unix(C.value).toDate():null,onChange:xe=>C.onChange(xe?P(xe).endOf("day").unix():null),minDate:new Date,locale:m.language.toLowerCase(),dateFormat:d("dateFormat"),customInput:e.jsx(H,{size:"sm",borderRadius:"6px",disabled:k})}),C.value&&e.jsx(Gr,{children:d(T,{time:Le})})]})}}),e.jsx(ge,{children:y.formState.errors.on_hold_expire_duration?.message||y.formState.errors.expire?.message})]}),e.jsxs(O,{children:[e.jsx(M,{children:d("userDialog.note")}),e.jsx(ds,{...y.register("note"),size:"sm",borderRadius:"6px",disabled:k}),e.jsx(ge,{children:y.formState.errors.note?.message})]}),u&&e.jsx(Me,{status:"error",borderRadius:"md",children:e.jsx(Be,{children:u})})]})}),e.jsx(Ae,{children:e.jsxs(O,{children:[e.jsx(M,{children:d("userDialog.protocols")}),e.jsx(X,{name:"selected_proxies",control:y.control,render:({field:C})=>e.jsx(qr,{value:C.value,onValueChange:C.onChange,disabled:k,children:hr.map(T=>e.jsxs(Qr,{value:T.title,children:[e.jsx(Zr,{}),e.jsx(Jr,{}),e.jsx(Xr,{children:T.description})]},T.title))})}),e.jsx(ge,{children:y.formState.errors.selected_proxies?.message})]})}),g&&re&&e.jsx(Ae,{colSpan:2,pt:6,children:e.jsxs(F,{gap:4,children:[e.jsx(ur,{defaultValue:ae,onChange:(C,T)=>{Ce(C),_(T)}}),e.jsx(i,{w:{base:"100%",md:"70%"},mx:"auto",children:e.jsx(zt,{options:te.options,series:te.series,type:"donut"})})]})})]}),u&&e.jsx(Me,{mt:"3",status:"error",display:{base:"flex",md:"none"},borderRadius:"md",children:e.jsx(Be,{children:u})}),e.jsx(i,{mt:"4",children:e.jsxs(b,{justify:"space-between",flexDir:{base:"column",sm:"row"},gap:3,children:[g&&e.jsxs(b,{gap:2,children:[e.jsxs(us,{children:[e.jsx(hs,{asChild:!0,children:e.jsx(A,{"aria-label":d("delete"),size:"sm",onClick:()=>{l(s),Te()},disabled:k,children:e.jsx(Cs,{})})}),e.jsx(xs,{children:e.jsx(gs,{children:d("delete")})})]}),e.jsxs(us,{children:[e.jsx(hs,{asChild:!0,children:e.jsx(A,{"aria-label":d("userDialog.usage"),size:"sm",onClick:()=>G(C=>!C),disabled:k,children:e.jsx(Ge,{className:"h-5 w-5"})})}),e.jsx(xs,{children:e.jsx(gs,{children:d("userDialog.usage")})})]}),e.jsx(L,{size:"sm",onClick:()=>R.setState({resetUsageUser:s}),disabled:k,children:d("userDialog.resetUsage")}),e.jsx(L,{size:"sm",onClick:()=>R.setState({revokeSubscriptionUser:s}),disabled:k,children:d("userDialog.revokeSubscription")})]}),e.jsx(L,{type:"submit",size:"sm",px:"8",colorPalette:"primary",loading:k,disabled:k,children:d(g?"userDialog.editUser":"createUser")})]})})]})})})]})})]})})},at="/admin/statics/add_file.C_1Bst-X.svg",ao={w:4,h:4,strokeWidth:2},We=s=>r=>e.jsx($.svg,{as:s,...ao,...r}),nt=We(Yt),no=We(Vt),ot=We(Kt),lt=We(Ze),oo=We(Ze),lo=[{title:"No",value:"no_reset"},{title:"Daily",value:"day"},{title:"Weekly",value:"week"},{title:"Monthly",value:"month"},{title:"Annually",value:"year"}],Ye={active:{statusColor:"green",bandWidthColor:"primary",icon:nt},connected:{statusColor:"green",bandWidthColor:"primary",icon:nt},disabled:{statusColor:"gray",bandWidthColor:"gray",icon:no},expired:{statusColor:"orange",bandWidthColor:"orange",icon:lt},on_hold:{statusColor:"purple",bandWidthColor:"purple",icon:oo},connecting:{statusColor:"orange",bandWidthColor:"orange",icon:lt},limited:{statusColor:"red",bandWidthColor:"red",icon:ot},error:{statusColor:"red",bandWidthColor:"red",icon:ot}},io=s=>{if(!s)return null;const r=new Date(`${s}Z`);return Math.floor(r.getTime()/1e3)},it=({lastOnline:s})=>{const r=Math.floor(Date.now()/1e3),t=io(s);return!s||t===null?e.jsx(i,{border:"1px solid",borderColor:"gray.400",_dark:{borderColor:"gray.600"},className:"circle"}):r-t<=60?e.jsx(i,{bg:"green.300",_dark:{bg:"green.500"},className:"circle pulse green"}):e.jsx(i,{bg:"gray.400",_dark:{bg:"gray.600"},className:"circle"})},co=s=>{if(!s)return null;const r=new Date(s+"Z");return Math.floor(r.getTime()/1e3)},ct=({lastOnline:s})=>{const r=Math.floor(Date.now()/1e3),t=co(s),a=t?r-t:null,n=t?Je(t):{time:"Not Connected Yet"};return e.jsx(p,{display:"inline-block",fontSize:"xs",fontWeight:"medium",ml:"2",color:"gray.600",_dark:{color:"gray.400"},children:a&&a<=60?"Online":a?`${n.time} ago`:n.time})},uo=$(ea),ho=$(sa),xo=()=>{const{filters:s,onFilterChange:r,users:{total:t}}=R(),{t:a}=E(),n=s.limit??10,o=(s.offset??0)/n,c=Math.max(1,Math.ceil(t/n)),l=m=>r({...s,offset:m*n}),x=m=>{const v=Number(m.target.value);an(String(v)),r({...s,limit:v,offset:0})},d=Ft({items:[10,20,30].map(m=>({value:String(m),label:String(m)}))});return e.jsxs(b,{mt:4,w:"full",justify:"space-between",gap:{base:4,md:0},flexDir:{base:"column",md:"row"},children:[e.jsx(i,{order:{base:2,md:1},children:e.jsxs(b,{children:[e.jsxs($t,{value:[String(n)],onValueChange:m=>x({target:{value:m.value[0]}}),collection:d,children:[e.jsx(Ot,{minW:"60px",rounded:"md"}),e.jsx(Mt,{children:e.jsx(Bt,{children:d.items.map(m=>e.jsx(Ht,{item:m,children:m.label},m.value))})})]}),e.jsx(p,{fontSize:"sm",whiteSpace:"nowrap",children:a("itemsPerPage")})]})}),e.jsx(ta,{count:t,pageSize:n,page:o+1,onPageChange:m=>l(m.page-1),siblingCount:1,children:e.jsxs(ra,{variant:"outline",size:"sm",attached:!0,order:{base:1,md:2},children:[e.jsx(aa,{asChild:!0,children:e.jsx(A,{"aria-label":a("previous"),disabled:o===0,children:e.jsx(uo,{boxSize:4})})}),e.jsx(na,{render:m=>e.jsx(A,{variant:m.type==="page"?"outline":"solid",type:"button",...m.type==="page"?{"aria-current":m.value===o+1?"page":void 0}:{},children:m.type==="page"?m.value:"…"},`${m.type}-${m.value}`)}),e.jsx(oa,{asChild:!0,children:e.jsx(A,{"aria-label":a("next"),disabled:o+1>=c,children:e.jsx(ho,{boxSize:4})})})]})})]})},go={w:4,h:4,strokeWidth:2},$e=s=>r=>e.jsx($.svg,{as:s,...go,...r}),dt=$e(Yt),mo=$e(Vt),ut=$e(Kt),ht=$e(Ze),po=$e(Ze),xt={active:{statusColor:"green",bandWidthColor:"primary",icon:dt},connected:{statusColor:"green",bandWidthColor:"primary",icon:dt},disabled:{statusColor:"gray",bandWidthColor:"gray",icon:mo},expired:{statusColor:"orange",bandWidthColor:"orange",icon:ht},on_hold:{statusColor:"purple",bandWidthColor:"purple",icon:po},connecting:{statusColor:"orange",bandWidthColor:"orange",icon:ht},limited:{statusColor:"red",bandWidthColor:"red",icon:ut},error:{statusColor:"red",bandWidthColor:"red",icon:ut}},os=({expiryDate:s,status:r,compact:t=!1,showDetail:a=!0,extraText:n})=>{const{t:o}=E(),c=Je(s),l=xt[r].icon;return e.jsxs(e.Fragment,{children:[e.jsxs(Re,{colorScheme:xt[r].statusColor,rounded:"full",display:"inline-flex",px:3,py:1,columnGap:t?1:2,alignItems:"center",children:[e.jsx(l,{w:t?3:4}),a&&e.jsxs(p,{textTransform:"capitalize",fontSize:t?".7rem":".875rem",lineHeight:t?"1rem":"1.25rem",fontWeight:"medium",letterSpacing:"tighter",children:[r&&o(`status.${r}`),n&&`: ${n}`]})]}),a&&s&&e.jsx(p,{display:"inline-block",fontSize:"xs",fontWeight:"medium",ml:"2",color:"gray.600",_dark:{color:"gray.400"},children:o(c.status,{time:c.time})})]})},fo=$(la),jo=$(Gt),gt=$(ia),bo=$(ca),vo=$(Nt),yo=$(zs),Co=$(Gt),So=s=>{const r=lo.find(t=>t.value===s);return r?Js(r.title):Js("No")},wo=s=>{const{used:r,total:t}=s,a=t===0||t===null;return e.jsx(b,{justifyContent:"space-between",fontSize:"xs",fontWeight:"medium",color:"gray.600",_dark:{color:"gray.400"},children:e.jsxs(p,{children:[K(r)," /"," ",a?e.jsx(p,{as:"span",fontFamily:"system-ui",children:"∞"}):K(t)]})})},mt=({used:s,total:r,dataLimitResetStrategy:t,totalUsedTraffic:a,colorScheme:n,...o})=>{const{t:c}=E(),l=r===0||r===null,x=l||!r?0:Math.min(s/r*100,100),d=!l&&r!==null&&s>=r;return e.jsxs(e.Fragment,{children:[e.jsxs(xa,{value:[x],colorScheme:d?"red":n||"primary",...o,children:[e.jsx(ga,{h:"6px",borderRadius:"full",children:e.jsx(ma,{borderRadius:"full"})}),e.jsx(pa,{index:0})]}),e.jsxs(b,{justifyContent:"space-between",fontSize:"xs",fontWeight:"medium",color:"gray.600",_dark:{color:"gray.400"},children:[e.jsxs(p,{children:[K(s)," /"," ",l?e.jsx(p,{as:"span",fontFamily:"system-ui",children:"∞"}):K(r)+(t&&t!=="no_reset"?" "+c(`userDialog.resetStrategy.${t}`,So(t)):"")]}),e.jsxs(p,{children:[c("usersTable.total"),": ",K(a)]})]})]})},we=({sort:s,column:r})=>s.includes(r)?e.jsx(Co,{transform:s.startsWith("-")?void 0:"rotate(180deg)"}):null,_o=s=>{const{filters:r,users:t,onEditingUser:a,onFilterChange:n}=R();console.error("UsersTable received usersData:",JSON.stringify(t,null,2));const{users:o,total:c}=t,{t:l}=E(),[x,d]=f.useState(void 0),[m,v]=f.useState("72px"),g=ke({base:!1,md:!0});f.useEffect(()=>{const u=()=>{const h=document.querySelectorAll("#filters")[0];h&&v(`${h.offsetHeight}px`)};return u(),window.addEventListener("resize",u),()=>{window.removeEventListener("resize",u)}},[]);const S=o.length!==c,y=u=>{let h=r.sort;h.includes(u)?h=h.startsWith("-")?u:`-${u}`:h=u,h===u&&r.sort===u?h=`-${u}`:h===`-${u}`&&r.sort===`-${u}`?h="-created_at":r.sort.includes(u)||(h=u),n({sort:h,offset:0})},k=u=>{const h=u.value.length>0?u.value[0]:"";n({status:h===""?void 0:h,offset:0})},U=x!==void 0?[x]:[];return e.jsxs(i,{children:[g?e.jsxs(ms,{display:{base:"none",md:"table"},...s,children:[e.jsx(ps,{zIndex:"docked",position:"relative",children:e.jsxs(le,{children:[e.jsx(V,{position:"sticky",top:{base:"unset",md:m},minW:"200px",cursor:"pointer",onClick:()=>y("account_number"),children:e.jsxs(b,{gap:1,children:[" ",e.jsx("span",{children:l("accountNumber")}),e.jsx(we,{sort:r.sort,column:"account_number"})]})}),e.jsx(V,{position:"sticky",top:{base:"unset",md:m},width:"250px",minW:"200px",children:e.jsxs(b,{position:"relative",justify:"space-between",w:"full",gap:0,children:[" ",e.jsxs(b,{flexGrow:1,cursor:"pointer",onClick:()=>y("status"),gap:1,children:[" ",e.jsxs(p,{userSelect:"none",children:[l("usersTable.status"),r.status?`: ${l(`status.${r.status}`,r.status)}`:""]}),e.jsx(we,{sort:r.sort,column:"status"})]}),e.jsx(p,{userSelect:"none",px:2,children:"/"}),e.jsxs(b,{cursor:"pointer",onClick:()=>y("expire"),gap:1,children:[" ",e.jsx(p,{userSelect:"none",children:l("usersTable.expireDate","Expire Date")}),e.jsx(we,{sort:r.sort,column:"expire"})]}),e.jsxs("select",{value:r.status||"",onChange:u=>k({value:[u.target.value]}),style:{width:"100%",fontSize:"0.875rem",padding:"0.5rem"},children:[e.jsx("option",{value:"",children:l("usersTable.allStatuses","All")}),e.jsx("option",{value:"active",children:l("status.active","Active")}),e.jsx("option",{value:"on_hold",children:l("status.on_hold","On Hold")}),e.jsx("option",{value:"disabled",children:l("status.disabled","Disabled")}),e.jsx("option",{value:"limited",children:l("status.limited","Limited")}),e.jsx("option",{value:"expired",children:l("status.expired","Expired")})]})]})}),e.jsx(V,{position:"sticky",top:{base:"unset",md:m},width:"350px",minW:"230px",cursor:"pointer",onClick:()=>y("used_traffic"),children:e.jsxs(b,{gap:1,children:[" ",e.jsx("span",{children:l("usersTable.dataUsage")}),e.jsx(we,{sort:r.sort,column:"used_traffic"})]})}),e.jsx(V,{position:"sticky",top:{base:"unset",md:m},width:"180px",minW:"150px"})]})}),e.jsxs(fs,{children:[o?.map((u,h)=>e.jsxs(le,{className:Ts("interactive",{"last-row":h===o.length-1}),onClick:()=>a(u),cursor:"pointer",_hover:{bg:"gray.50",_dark:{bg:"gray.700"}},children:[e.jsxs(B,{minW:"200px",children:[e.jsxs(b,{gap:2,children:[" ",e.jsx(it,{lastOnline:u.online_at}),e.jsx(p,{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},title:u.account_number,children:u.account_number})]}),e.jsx(ct,{lastOnline:u.online_at})]}),e.jsx(B,{width:"250px",minW:"200px",children:e.jsx(os,{expiryDate:u.expire,status:u.status,compact:!1})}),e.jsx(B,{width:"350px",minW:"230px",children:e.jsx(mt,{totalUsedTraffic:u.lifetime_used_traffic,dataLimitResetStrategy:u.data_limit_reset_strategy,used:u.used_traffic,total:u.data_limit,colorScheme:Ye[u.status]?.bandWidthColor||"primary"})}),e.jsx(B,{width:"180px",minW:"150px",children:e.jsx(pt,{user:u})})]},u.account_number)),o.length===0&&e.jsx(le,{children:e.jsx(B,{colSpan:4,children:e.jsx(ko,{isFiltered:S})})})]})]}):e.jsx(da,{collapsible:!0,value:U,onValueChange:u=>{d(u.value.length>0?u.value[0]:void 0)},display:{base:"block",md:"none"},children:e.jsxs(ms,{zIndex:"docked",...s,children:[e.jsx(ps,{zIndex:"docked",position:"relative",children:e.jsxs(le,{children:[e.jsx(V,{position:"sticky",top:m,minW:"120px",pl:4,pr:4,cursor:"pointer",onClick:()=>y("account_number"),children:e.jsxs(b,{gap:1,children:[" ",e.jsx("span",{children:l("accountNumber")}),e.jsx(we,{sort:r.sort,column:"account_number"})]})}),e.jsx(V,{position:"sticky",top:m,minW:"140px",pl:0,pr:0,w:"140px",children:e.jsxs(b,{gap:0,position:"relative",children:[" ",e.jsxs(p,{position:"absolute",left:2,top:"50%",transform:"translateY(-50%)",_dark:{bg:"gray.750"},_light:{bg:"gray.50"},userSelect:"none",pointerEvents:"none",zIndex:1,fontSize:"xs",fontWeight:"extrabold",textTransform:"uppercase",children:[l("usersTable.status"),r.status?`: ${l(`status.${r.status}`,r.status)}`:""]}),e.jsxs("select",{value:r.status||"",onChange:u=>k({value:[u.target.value]}),style:{width:"100%",fontSize:"0.875rem",padding:"0.5rem"},children:[e.jsx("option",{value:"",children:l("usersTable.allStatuses","All")}),e.jsx("option",{value:"active",children:l("status.active","Active")}),e.jsx("option",{value:"on_hold",children:l("status.on_hold","On Hold")}),e.jsx("option",{value:"disabled",children:l("status.disabled","Disabled")}),e.jsx("option",{value:"limited",children:l("status.limited","Limited")}),e.jsx("option",{value:"expired",children:l("status.expired","Expired")})]})]})}),e.jsx(V,{position:"sticky",top:m,minW:"100px",cursor:"pointer",pr:0,onClick:()=>y("used_traffic"),children:e.jsxs(b,{gap:1,children:[" ",e.jsx("span",{children:l("usersTable.dataUsage")}),e.jsx(we,{sort:r.sort,column:"used_traffic"})]})}),e.jsx(V,{position:"sticky",top:m,minW:"32px",w:"32px",p:0})]})}),e.jsx(fs,{children:o?.map((u,h)=>{const w=h.toString();return e.jsx(f.Fragment,{children:e.jsxs(ua,{value:w,border:"none",children:[" ",e.jsxs(le,{onClick:()=>d(x===w?void 0:w),cursor:"pointer",children:[e.jsx(B,{borderBottom:x===w?0:"1px solid",borderColor:"inherit",minW:"100px",pl:4,pr:4,maxW:"calc(100vw - 140px - 100px - 32px - 32px)",children:e.jsx(Zs,{asChild:!0,children:e.jsxs(b,{gap:2,width:"100%",children:[" ",e.jsx(it,{lastOnline:u.online_at}),e.jsx(p,{style:{overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap"},title:u.account_number,children:u.account_number})]})})}),e.jsx(B,{borderBottom:x===w?0:"1px solid",borderColor:"inherit",minW:"140px",pl:0,pr:0,children:e.jsx(os,{compact:!0,showDetail:!1,expiryDate:u.expire,status:u.status})}),e.jsx(B,{borderBottom:x===w?0:"1px solid",borderColor:"inherit",minW:"100px",pr:0,children:e.jsx(wo,{totalUsedTraffic:u.lifetime_used_traffic,dataLimitResetStrategy:u.data_limit_reset_strategy,used:u.used_traffic,total:u.data_limit})}),e.jsx(B,{p:0,borderBottom:x===w?0:"1px solid",borderColor:"inherit",w:"32px",minW:"32px",children:e.jsx(Zs,{asChild:!0,children:e.jsx(jo,{color:"gray.600",_dark:{color:"gray.400"},transition:"transform .2s ease-out",transform:x===w?"rotate(180deg)":"rotate(0deg)"})})})]}),e.jsxs(ha,{children:[" ",x===w&&e.jsx(le,{className:"collapsible expanded",children:e.jsx(B,{p:0,colSpan:4,borderBottomWidth:"1px",children:e.jsxs(i,{px:6,py:3,cursor:"default",children:[" ",e.jsxs(F,{gap:4,justifyContent:"space-between",children:[" ",e.jsxs(F,{gap:1,alignItems:"flex-start",w:"full",children:[" ",e.jsx(p,{textTransform:"capitalize",fontSize:"xs",fontWeight:"bold",color:"gray.600",_dark:{color:"gray.400"},children:l("usersTable.dataUsage")}),e.jsx(i,{width:"full",minW:"230px",children:e.jsx(mt,{totalUsedTraffic:u.lifetime_used_traffic,dataLimitResetStrategy:u.data_limit_reset_strategy,used:u.used_traffic,total:u.data_limit,colorScheme:Ye[u.status]?.bandWidthColor||"primary"})})]}),e.jsxs(b,{w:"full",justifyContent:"space-between",children:[e.jsxs(i,{width:"full",children:[e.jsx(os,{compact:!1,expiryDate:u.expire,status:u.status}),e.jsx(ct,{lastOnline:u.online_at})]}),e.jsx(b,{children:e.jsx(pt,{user:u})})]})]})]})})})]})]})},u.account_number)})})]})}),c>(r.limit||0)&&e.jsx(xo,{})]})},pt=({user:s})=>{const{setQRCode:r,setSubLink:t,onEditingUser:a}=R(),n=s.links?.join(`\r
`)||"",[o,c]=f.useState([-1,!1]),{t:l}=E();f.useEffect(()=>{let d;return o[1]&&(d=setTimeout(()=>{c([-1,!1])},1e3)),()=>clearTimeout(d)},[o]);const x=(d,m)=>{d&&navigator.clipboard.writeText(d).then(()=>c([m,!0])).catch(v=>console.error("Failed to copy text: ",v))};return e.jsxs(b,{gap:{base:1,md:2},justifyContent:"flex-end",onClick:d=>{d.preventDefault(),d.stopPropagation()},children:[e.jsx(A,{"aria-label":l("usersTable.copyLink","Copy Subscription Link"),variant:"ghost",size:"sm",onClick:()=>{const d=s.subscription_url.startsWith("/")?window.location.origin+s.subscription_url:s.subscription_url;x(d,0)},title:o[0]===0&&o[1]?l("usersTable.copied","Copied!"):l("usersTable.copyLink","Copy Subscription Link"),children:o[0]===0&&o[1]?e.jsx(gt,{}):e.jsx(bo,{})}),e.jsx(A,{"aria-label":l("usersTable.copyConfigs","Copy All Configs"),variant:"ghost",size:"sm",onClick:()=>x(n,1),disabled:!n,children:o[0]===1&&o[1]?e.jsx(gt,{}):e.jsx(fo,{})}),e.jsx(A,{"aria-label":l("usersTable.qrCode","QR Code"),variant:"ghost",size:"sm",onClick:()=>{s.links&&s.links.length>0&&r(s.links),t(s.subscription_url)},disabled:!s.links||s.links.length===0,children:e.jsx(vo,{})}),e.jsx(A,{"aria-label":l("userDialog.editUser","Edit User"),variant:"ghost",size:"sm",onClick:()=>a(s),children:e.jsx(yo,{})})]})},ko=({isFiltered:s})=>{const{onCreateUser:r}=R(),{t}=E();return e.jsxs(i,{padding:"5",py:"8",display:"flex",alignItems:"center",flexDirection:"column",gap:4,w:"full",children:[e.jsx("img",{src:at,alt:"Empty section",height:"150",width:"150",style:{display:"block"}}),e.jsx(p,{fontWeight:"medium",color:"gray.600",_dark:{color:"gray.400"},children:s?t("usersTable.noUserMatched","No users matched your filters."):t("usersTable.noUser","No users found.")}),!s&&e.jsxs(L,{size:"sm",colorScheme:"primary",onClick:()=>r(!0),children:[e.jsx("img",{src:at,alt:"",style:{width:"1em",height:"1em",marginRight:4,display:"inline-block",verticalAlign:"middle"}}),t("createUser","Create User")]})]})},Ro=({expiryDate:s,status:r,compact:t=!1,showDetail:a=!0,extraText:n})=>{const{t:o}=E(),c=Je(s),l=Ye[r].icon;return e.jsxs(e.Fragment,{children:[e.jsxs(Re,{colorScheme:Ye[r].statusColor,rounded:"full",display:"inline-flex",px:3,py:1,columnGap:t?1:2,alignItems:"center",children:[e.jsx(l,{w:t?3:4}),a&&e.jsxs(p,{textTransform:"capitalize",fontSize:t?".7rem":".875rem",lineHeight:t?"1rem":"1.25rem",fontWeight:"medium",letterSpacing:"tighter",children:[r&&o(`nodeModal.status.${r}`),n&&`: ${n}`]})]}),a&&s&&e.jsx(p,{display:"inline-block",fontSize:"xs",fontWeight:"medium",ml:"2",color:"gray.600",_dark:{color:"gray.400"},children:o(c.status,{time:c.time})})]})},Do=({pem:s})=>{const{t:r}=E(),t=new Blob([s],{type:"text/plain"}),a=URL.createObjectURL(t);return e.jsx(L,{asChild:!0,size:"xs",colorPalette:"primary",variant:"solid",children:e.jsx("a",{href:a,download:"ssl_client_cert.pem",children:r("nodes.download-certificate")})})},ls=({label:s,shown:r,onToggle:t})=>e.jsxs(us,{children:[e.jsx(hs,{asChild:!0,children:e.jsx(A,{"aria-label":s,size:"xs",variant:"ghost",onClick:t,children:r?e.jsx(ja,{className:"w-4 h-4"}):e.jsx(ba,{className:"w-4 h-4"})})}),e.jsx(xs,{children:e.jsx(gs,{children:s})})]});function To(s){const r=window.getSelection();if(!r)return;const t=document.createRange();t.selectNodeContents(s),r.removeAllRanges(),r.addRange(t)}const Lo=({initialValues:s,onSubmit:r,submitText:t})=>{const{t:a}=E(),[n,o]=f.useState(!1),[c,l]=f.useState(!1),[x,d]=f.useState(!1),{data:m}=Ke({queryKey:["certificate"],queryFn:()=>I.get("/api/certificate")}),v=qe({resolver:Is(on),defaultValues:s??{name:"",address:"",port:0,api_port:0,usage_coefficient:1,status:"connecting",panel_client_cert:"",panel_client_key:""}}),g=async S=>{try{await r(S)}catch(y){De.create({title:a("error"),description:y.message||a("nodes.errorSaving"),type:"error",duration:5e3,closable:!0})}};return e.jsx("form",{onSubmit:v.handleSubmit(g),children:e.jsxs(F,{gap:4,children:[m&&e.jsx(Me,{status:"info",alignItems:"flex-start",children:e.jsxs(Be,{display:"flex",flexDirection:"column",overflow:"hidden",children:[e.jsx("span",{children:a("nodes.connection-hint")}),e.jsxs(b,{justify:"flex-end",py:2,gap:2,wrap:"wrap",children:[e.jsx(Do,{pem:m.certificate}),e.jsx(ls,{label:a(n?"nodes.hide-certificate":"nodes.show-certificate"),shown:n,onToggle:()=>o(S=>!S)})]}),e.jsx(Pt,{open:n,children:e.jsx(Wt,{children:e.jsx(p,{bg:"whiteAlpha.500",_osDark:{bg:"whiteAlpha.200"},rounded:"md",p:2,fontSize:"10px",fontFamily:"Courier",whiteSpace:"pre",overflow:"auto",lineHeight:"1.2",onClick:S=>To(S.currentTarget),children:m.certificate})})})]})}),e.jsxs(b,{w:"full",gap:3,wrap:"wrap",children:[e.jsxs(O,{invalid:!!v.formState.errors.name,flex:1,minW:"200px",children:[e.jsx(M,{children:a("nodes.nodeName")}),e.jsx(H,{placeholder:"Marzban-S2",...v.register("name")})]}),e.jsx(X,{name:"status",control:v.control,render:({field:S})=>e.jsx(cs,{id:"node-status-switch",checked:S.value!=="disabled",onCheckedChange:y=>S.onChange(y.checked?"connecting":"disabled"),"aria-label":a("nodes.statusToggle"),children:e.jsx(fa,{})})})]}),e.jsxs(O,{invalid:!!v.formState.errors.address,w:"full",children:[e.jsx(M,{children:a("nodes.nodeAddress")}),e.jsx(H,{placeholder:"51.20.12.13",...v.register("address")})]}),e.jsxs(b,{w:"full",gap:3,wrap:"wrap",children:[e.jsxs(O,{invalid:!!v.formState.errors.port,flex:1,minW:"120px",children:[e.jsx(M,{children:a("nodes.nodePort")}),e.jsx(H,{type:"number",placeholder:"62050",...v.register("port",{valueAsNumber:!0})})]}),e.jsxs(O,{invalid:!!v.formState.errors.api_port,flex:1,minW:"120px",children:[e.jsx(M,{children:a("nodes.nodeAPIPort")}),e.jsx(H,{type:"number",placeholder:"62051",...v.register("api_port",{valueAsNumber:!0})})]}),e.jsxs(O,{invalid:!!v.formState.errors.usage_coefficient,flex:1,minW:"140px",children:[e.jsx(M,{children:a("nodes.usageCoefficient")}),e.jsx(H,{type:"number",placeholder:"1",...v.register("usage_coefficient",{valueAsNumber:!0})})]})]}),e.jsxs(O,{invalid:!!v.formState.errors.panel_client_cert,w:"full",children:[e.jsx(M,{children:a("nodes.panelClientCert")}),e.jsxs(b,{align:"start",gap:2,wrap:"wrap",children:[e.jsx(ds,{placeholder:a("nodes.pastePanelClientCert"),fontFamily:"monospace",rows:7,flex:1,...v.register("panel_client_cert")}),e.jsx(ls,{label:a(c?"nodes.hide-certificate":"nodes.show-certificate"),shown:c,onToggle:()=>l(S=>!S)})]})]}),e.jsxs(O,{invalid:!!v.formState.errors.panel_client_key,w:"full",children:[e.jsx(M,{children:a("nodes.panelClientKey")}),e.jsxs(b,{align:"start",gap:2,wrap:"wrap",children:[e.jsx(ds,{placeholder:a("nodes.pastePanelClientKey"),fontFamily:"monospace",rows:7,flex:1,...v.register("panel_client_key")}),e.jsx(ls,{label:a(x?"nodes.hide-certificate":"nodes.show-certificate"),shown:x,onToggle:()=>d(S=>!S)})]})]}),e.jsx(L,{type:"submit",colorPalette:"primary",loading:v.formState.isSubmitting,w:"full",children:t})]})})};var _s=(s=>(s.VLESS="vless",s.VMESS="vmess",s.TROJAN="trojan",s.SHADOWSOCKS="shadowsocks",s.HTTP="http",s.SOCKS="socks",s))(_s||{}),ks=(s=>(s.TCP="tcp",s.KCP="kcp",s.WS="ws",s.HTTP="http",s.GRPC="grpc",s.QUIC="quic",s))(ks||{}),Rs=(s=>(s.NONE="none",s.TLS="tls",s.REALITY="reality",s))(Rs||{});const Uo=({nodeId:s})=>{const[r,t]=f.useState([]),[a,n]=f.useState(!1),[o,c]=f.useState(null),[l,x]=f.useState({service_name:"",enabled:!0,protocol_type:_s.VLESS,listen_port:443,security_type:Rs.TLS}),{open:d,onOpen:m,onClose:v}=Us(),g=async()=>{try{n(!0);const j=await Ln(s);t(j)}catch(j){console.error("Error fetching services:",j)}finally{n(!1)}};f.useEffect(()=>{g()},[s]);const S=()=>{c(null),m()},y=j=>{c(j),m()},k=async j=>{if(window.confirm("Are you sure you want to delete this service?"))try{await An(s,j),g()}catch(z){console.error("Error deleting service:",z)}},U=(j,z)=>{x(W=>({...W,[j]:z}))},u=j=>z=>{try{const W=JSON.parse(z);U(j,W)}catch{}},h=async j=>{j.preventDefault();try{o?await tt(s,o.id,l):await Un(s,l),v(),g()}catch(z){console.error("Error saving service:",z)}},w=async(j,z)=>{try{await tt(s,j.id,{...j,enabled:z}),g()}catch(W){console.error("Error updating service:",W)}};return e.jsxs(i,{children:[e.jsxs(L,{colorScheme:"blue",mb:4,onClick:S,children:[e.jsx(va,{}),"Add Service"]}),e.jsxs(i,{as:"table",width:"100%",children:[e.jsx(i,{as:"thead",children:e.jsxs(i,{as:"tr",children:[e.jsx(i,{as:"th",children:"Service Name"}),e.jsx(i,{as:"th",children:"Protocol"}),e.jsx(i,{as:"th",children:"Port"}),e.jsx(i,{as:"th",children:"Network"}),e.jsx(i,{as:"th",children:"Security"}),e.jsx(i,{as:"th",children:"Enabled"}),e.jsx(i,{as:"th",children:"Actions"})]})}),e.jsx(i,{as:"tbody",children:r.map(j=>e.jsxs(i,{as:"tr",children:[e.jsx(i,{as:"td",children:j.service_name}),e.jsx(i,{as:"td",children:j.protocol_type}),e.jsx(i,{as:"td",children:j.listen_port}),e.jsx(i,{as:"td",children:j.network_type||"TCP"}),e.jsx(i,{as:"td",children:j.security_type}),e.jsx(i,{as:"td",children:e.jsx("input",{type:"checkbox",checked:j.enabled,onChange:z=>w(j,z.target.checked)})}),e.jsxs(i,{as:"td",children:[e.jsx(A,{"aria-label":"Edit service",size:"sm",mr:2,onClick:()=>y(j),children:e.jsx(ya,{})}),e.jsx(A,{"aria-label":"Delete service",size:"sm",colorScheme:"red",onClick:()=>k(j.id),children:e.jsx(Ca,{})})]})]},j.id))})]}),d&&e.jsx(i,{position:"fixed",top:"0",left:"0",right:"0",bottom:"0",bg:"blackAlpha.600",zIndex:"modal",onClick:v,children:e.jsxs(i,{position:"absolute",top:"50%",left:"50%",transform:"translate(-50%, -50%)",bg:"white",p:6,borderRadius:"md",width:"xl",maxW:"90vw",maxH:"90vh",overflowY:"auto",onClick:j=>j.stopPropagation(),children:[e.jsxs(i,{display:"flex",justifyContent:"space-between",alignItems:"center",mb:4,children:[e.jsx(i,{fontSize:"xl",fontWeight:"bold",children:o?"Edit Service":"Add Service"}),e.jsx(L,{variant:"ghost",onClick:v,children:"×"})]}),e.jsx("form",{onSubmit:h,children:e.jsxs(F,{gap:4,children:[e.jsxs(i,{children:[e.jsx(i,{as:"label",children:"Service Name"}),e.jsx(H,{value:l.service_name,onChange:j=>U("service_name",j.target.value)})]}),e.jsxs(i,{children:[e.jsx(i,{as:"label",children:"Protocol Type"}),e.jsx("select",{value:l.protocol_type,onChange:j=>U("protocol_type",j.target.value),children:Object.values(_s).map(j=>e.jsx("option",{value:j,children:j},j))})]}),e.jsxs(i,{children:[e.jsx(i,{as:"label",children:"Listen Port"}),e.jsx(H,{type:"number",value:l.listen_port,onChange:j=>U("listen_port",parseInt(j.target.value))})]}),e.jsxs(i,{children:[e.jsx(i,{as:"label",children:"Network Type"}),e.jsx("select",{value:l.network_type||ks.TCP,onChange:j=>U("network_type",j.target.value),children:Object.values(ks).map(j=>e.jsx("option",{value:j,children:j},j))})]}),e.jsxs(i,{children:[e.jsx(i,{as:"label",children:"Security Type"}),e.jsx("select",{value:l.security_type,onChange:j=>U("security_type",j.target.value),children:Object.values(Rs).map(j=>e.jsx("option",{value:j,children:j},j))})]}),e.jsxs(i,{children:[e.jsx(i,{as:"label",children:"Advanced Protocol Settings"}),e.jsx(_e,{json:l.advanced_protocol_settings||{},onChange:u("advanced_protocol_settings")})]}),e.jsxs(i,{children:[e.jsx(i,{as:"label",children:"Advanced Stream Settings"}),e.jsx(_e,{json:l.advanced_stream_settings||{},onChange:u("advanced_stream_settings")})]}),e.jsxs(i,{children:[e.jsx(i,{as:"label",children:"Advanced TLS Settings"}),e.jsx(_e,{json:l.advanced_tls_settings||{},onChange:u("advanced_tls_settings")})]}),e.jsxs(i,{children:[e.jsx(i,{as:"label",children:"Advanced REALITY Settings"}),e.jsx(_e,{json:l.advanced_reality_settings||{},onChange:u("advanced_reality_settings")})]}),e.jsxs(i,{children:[e.jsx(i,{as:"label",children:"Sniffing Settings"}),e.jsx(_e,{json:l.sniffing_settings||{},onChange:u("sniffing_settings")})]}),e.jsxs(b,{gap:4,width:"100%",justify:"flex-end",children:[e.jsx(L,{onClick:v,children:"Cancel"}),e.jsx(L,{type:"submit",colorScheme:"blue",children:o?"Update":"Add"})]})]})})]})})]})},Ao=({open:s,onClose:r,node:t})=>{const{t:a}=E(),{addNode:n,updateNode:o}=Pe(),c=async l=>{t?await o(l):await n(l),r()};return e.jsxs(q,{open:s,onOpenChange:l=>!l&&r(),placement:"center",children:[e.jsx(Q,{bg:"blackAlpha.300",backdropFilter:"blur(10px)"}),e.jsx(de,{children:e.jsxs(Z,{w:"full",maxW:"xl",mx:3,children:[e.jsx(ie,{pt:6,children:e.jsx(p,{fontWeight:"semibold",fontSize:"lg",children:a(t?"nodes.editNode":"nodes.addNewNode")})}),e.jsx(ue,{mt:3}),e.jsx(ce,{pb:6,children:e.jsxs(As,{defaultValue:"basic",children:[e.jsxs(Es,{children:[e.jsx(je,{value:"basic",children:a("nodes.basicSettings")}),t&&e.jsx(je,{value:"services",children:a("nodes.services")})]}),e.jsx(be,{value:"basic",children:e.jsx(Lo,{initialValues:t,onSubmit:c,submitText:a(t?"update":"add")})}),t&&t.id&&e.jsx(be,{value:"services",children:e.jsx(Uo,{nodeId:t.id})})]})})]})})]})},Eo=()=>{const{deletingNode:s,setDeletingNode:r}=Pe(),{t}=E(),a=Sa(),n=()=>r(null),o=_t({mutationFn:l=>I.delete(`/api/core/api/node/${l}`),onSuccess:()=>{a.invalidateQueries({queryKey:["nodes"]}),n()}}),c=()=>{s&&s.id!=null&&o.mutate(s.id)};return e.jsxs(q,{role:"alertdialog",open:!!s,onOpenChange:l=>!l.open&&n(),placement:"center",children:[e.jsx(Q,{className:"backdrop-blur-sm bg-black/30"}),e.jsx(de,{children:e.jsxs(Z,{maxW:"sm",mx:"3",children:[e.jsx(ie,{pt:6,pb:2,justifyContent:"center",children:e.jsx(se,{color:"red",children:e.jsx(Cs,{})})}),e.jsxs(ce,{px:6,pb:4,children:[e.jsx(p,{fontWeight:"semibold",fontSize:"lg",children:t("deleteNode.title")}),s&&e.jsx(p,{mt:1,fontSize:"sm",color:"gray.600",_osDark:{color:"gray.400"},children:e.jsx(Ls,{i18nKey:"deleteNode.prompt",values:{name:s.name},components:{b:e.jsx("b",{})}})})]}),e.jsxs(ve,{gap:3,px:6,pb:6,flexDir:"column",children:[e.jsx(L,{variant:"outline",size:"sm",w:"full",onClick:n,children:t("cancel")}),e.jsxs(L,{size:"sm",w:"full",colorPalette:"red",loading:o.isPending,onClick:c,children:[o.isPending&&e.jsx(Ne,{size:"xs",mr:2}),t("delete")]})]})]})})]})},Io=()=>{const{t:s}=E(),{data:r}=sr(),{setDeletingNode:t,reconnectNode:a}=Pe(),{open:n,onOpen:o,onClose:c}=Us(),[l,x]=f.useState(null),d=g=>{x(g),o()},m=g=>t(g),v=g=>a(g);return e.jsxs(i,{children:[e.jsxs(F,{gap:4,align:"stretch",children:[e.jsx(b,{justify:"flex-end",children:e.jsx(L,{size:"sm",colorPalette:"primary",onClick:()=>{x(null),o()},children:s("nodes.addNewNode")})}),e.jsxs(ms,{variant:"line",size:"sm",striped:!0,stickyHeader:!0,children:[e.jsx(ps,{children:e.jsxs(le,{children:[e.jsx(V,{children:s("nodes.nodeName")}),e.jsx(V,{children:s("nodes.nodeAddress")}),e.jsx(V,{children:s("nodes.status")}),e.jsx(V,{children:s("nodes.xrayVersion")}),e.jsx(V,{children:s("nodes.actions")})]})}),e.jsx(fs,{children:r?.map(g=>e.jsxs(le,{children:[e.jsx(B,{children:g.name}),e.jsx(B,{children:g.address}),e.jsx(B,{children:e.jsx(Ro,{status:g.status||"connecting"})}),e.jsx(B,{children:g.xray_version||"-"}),e.jsx(B,{children:e.jsxs(b,{gap:1,children:[e.jsx(A,{"aria-label":s("edit"),size:"sm",onClick:()=>d(g),children:e.jsx(zs,{className:"h-4 w-4"})}),e.jsx(A,{"aria-label":s("delete"),size:"sm",colorPalette:"red",onClick:()=>m(g),children:e.jsx(kt,{className:"h-4 w-4"})}),g.status==="error"&&e.jsx(A,{"aria-label":s("nodes.reconnect"),size:"sm",onClick:()=>v(g),children:e.jsx(tr,{})})]})})]},g.id))})]})]}),e.jsx(Ao,{open:n,onClose:c,node:l}),e.jsx(Eo,{})]})},zo=()=>{const[s,r]=f.useState(null),[t,a]=f.useState(null),[n,o]=f.useState([]),[c,l]=f.useState(!0),[x,d]=f.useState(null),m=async()=>{try{l(!0);const h=await fetch("/api/admin/certificates/status",{headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`}});if(h.ok){const w=await h.json();r(w)}else console.error("Failed to fetch certificate status")}catch(h){console.error("Error fetching certificate status:",h)}finally{l(!1)}},v=async()=>{try{const h=await fetch("/api/admin/certificates/ca",{headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`}});if(h.ok){const w=await h.json();a(w)}}catch(h){console.error("Failed to fetch CA info:",h)}},g=async()=>{try{const h=await fetch("/api/admin/nodes",{headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`}});if(h.ok){const w=await h.json(),j=await Promise.all(w.map(async z=>{try{const W=await fetch(`/api/admin/certificates/node/${z.name}`,{headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`}});if(W.ok)return await W.json()}catch(W){console.error(`Failed to fetch certs for ${z.name}:`,W)}return null}));o(j.filter(Boolean))}}catch(h){console.error("Failed to fetch nodes:",h)}};f.useEffect(()=>{m(),v(),g()},[]);const S=async()=>{if(confirm("Are you sure? This will regenerate the CA and require updating all node certificates."))try{d("regenerate-ca"),(await fetch("/api/admin/certificates/ca/regenerate",{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`}})).ok?(alert("CA certificate regenerated successfully"),m(),v(),g()):alert("Failed to regenerate CA certificate")}catch{alert("Failed to regenerate CA certificate")}finally{d(null)}},y=async h=>{try{d(`rotate-${h}`);const w=await fetch(`/api/admin/certificates/node/${h}/rotate`,{method:"POST",headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`}});if(w.ok)alert(`Certificates rotated for ${h}`),m(),g();else{const j=await w.json();alert(`Failed to rotate certificates: ${j.detail||"Unknown error"}`)}}catch(w){alert(`Failed to rotate certificates: ${w}`)}finally{d(null)}},k=async h=>{try{d(`export-${h}`);const w=await fetch(`/api/admin/certificates/node/${h}/export`,{headers:{Authorization:`Bearer ${localStorage.getItem("access_token")}`}});if(w.ok){const j=await w.json();alert(`Certificates exported for ${h}. Check /tmp/marzban-certs/${h}/`)}else alert("Failed to export certificates")}catch{alert("Failed to export certificates")}finally{d(null)}},U=h=>new Date(h).toLocaleDateString("en-US",{year:"numeric",month:"short",day:"numeric",hour:"2-digit",minute:"2-digit"}),u=h=>{const w=new Date(h),j=new Date,z=Math.floor((w.getTime()-j.getTime())/(1e3*60*60*24));return z<0?{color:"red",text:"Expired",icon:ka}:z<=30?{color:"orange",text:"Expiring Soon",icon:Ra}:{color:"green",text:"Valid",icon:Da}};return c?e.jsx(i,{display:"flex",justifyContent:"center",alignItems:"center",height:"300px",children:e.jsx(Ne,{size:"lg"})}):e.jsxs(F,{gap:6,align:"stretch",children:[e.jsxs(i,{borderWidth:"1px",borderRadius:"lg",p:6,children:[e.jsxs(b,{mb:4,children:[e.jsx(wa,{size:"24px"}),e.jsx(es,{size:"md",children:"Certificate Management"}),e.jsx(ss,{}),e.jsxs(L,{size:"sm",onClick:()=>{m(),v(),g()},loading:c,children:[e.jsx(ts,{})," Refresh"]})]}),s?.recommendations&&e.jsx(F,{gap:2,align:"stretch",children:s.recommendations.map((h,w)=>e.jsx(i,{p:3,borderRadius:"md",bg:h.includes("healthy")?"green.50":"blue.50",borderLeftWidth:"4px",borderLeftColor:h.includes("healthy")?"green.400":"blue.400",children:e.jsx(p,{fontSize:"sm",children:h})},w))})]}),e.jsxs(i,{borderWidth:"1px",borderRadius:"lg",p:6,children:[e.jsxs(b,{mb:4,children:[e.jsx(es,{size:"md",children:"Certificate Authority (CA)"}),e.jsx(ss,{}),e.jsxs(L,{colorScheme:"red",size:"sm",onClick:S,loading:x==="regenerate-ca",children:[e.jsx(ts,{})," Regenerate CA"]})]}),t?e.jsxs(F,{align:"stretch",gap:3,children:[e.jsxs(b,{children:[e.jsx(p,{fontWeight:"bold",children:"Subject:"}),e.jsx(p,{children:t.subject_name})]}),e.jsxs(b,{children:[e.jsx(p,{fontWeight:"bold",children:"Valid From:"}),e.jsx(p,{children:U(t.valid_from)})]}),e.jsxs(b,{children:[e.jsx(p,{fontWeight:"bold",children:"Valid Until:"}),e.jsx(p,{children:U(t.valid_until)}),e.jsx(Re,{colorScheme:u(t.valid_until).color,children:u(t.valid_until).text})]})]}):e.jsxs(i,{p:4,borderRadius:"md",bg:"orange.50",borderLeftWidth:"4px",borderLeftColor:"orange.400",children:[e.jsx(p,{fontWeight:"bold",children:"No CA Certificate"}),e.jsx(p,{fontSize:"sm",children:"No Certificate Authority found. One will be created automatically when needed."})]})]}),e.jsxs(i,{borderWidth:"1px",borderRadius:"lg",p:6,children:[e.jsx(es,{size:"md",mb:4,children:"Node Certificates"}),n.length>0?e.jsx(F,{gap:4,align:"stretch",children:n.map(h=>e.jsx(i,{borderWidth:"1px",borderRadius:"md",p:4,children:e.jsxs(F,{align:"stretch",gap:3,children:[e.jsxs(b,{children:[e.jsx(p,{fontWeight:"bold",fontSize:"lg",children:h.node_name}),e.jsx(ss,{}),e.jsxs(b,{gap:2,children:[e.jsxs(L,{size:"sm",onClick:()=>y(h.node_name),loading:x===`rotate-${h.node_name}`,children:[e.jsx(ts,{})," Rotate"]}),e.jsxs(L,{size:"sm",onClick:()=>k(h.node_name),loading:x===`export-${h.node_name}`,children:[e.jsx(_a,{})," Export"]})]})]}),e.jsxs(b,{children:[e.jsx(p,{fontWeight:"bold",children:"Server Certificate:"}),e.jsx(p,{fontSize:"sm",children:U(h.certificates.server_cert.valid_until)}),e.jsx(Re,{colorScheme:u(h.certificates.server_cert.valid_until).color,size:"sm",children:u(h.certificates.server_cert.valid_until).text})]}),e.jsxs(b,{children:[e.jsx(p,{fontWeight:"bold",children:"Panel Client Certificate:"}),e.jsx(p,{fontSize:"sm",children:U(h.certificates.panel_client_cert.valid_until)}),e.jsx(Re,{colorScheme:u(h.certificates.panel_client_cert.valid_until).color,size:"sm",children:u(h.certificates.panel_client_cert.valid_until).text})]})]})},h.node_name))}):e.jsxs(i,{p:4,borderRadius:"md",bg:"blue.50",borderLeftWidth:"4px",borderLeftColor:"blue.400",children:[e.jsx(p,{fontWeight:"bold",children:"No Node Certificates"}),e.jsx(p,{fontSize:"sm",children:"Certificates will be generated automatically when you add nodes."})]})]})]})},No=()=>{const{deletingUser:s,onDeletingUser:r,resetUsageUser:t,onResetUsageUser:a,revokeSubscriptionUser:n,onRevokeSubscriptionUser:o,refetchUsers:c}=R(),{t:l}=E();return f.useEffect(()=>{c(),er()},[c]),e.jsxs(F,{justifyContent:"space-between",minH:"100vh",p:"6",rowGap:4,children:[e.jsxs(i,{w:"full",children:[e.jsx(Mn,{}),e.jsx(tn,{mt:"4"}),e.jsxs(As,{defaultValue:"users",children:[e.jsxs(Es,{children:[e.jsx(je,{value:"users",children:l("admin.users")}),e.jsx(je,{value:"nodes",children:l("admin.nodes")}),e.jsx(je,{value:"certificates",children:l("admin.certificates","Certificates")})]}),e.jsxs(be,{value:"users",children:[e.jsx(yn,{}),e.jsx(_o,{}),e.jsx(ro,{}),s&&e.jsx(fn,{open:!!s,onClose:()=>r(null),user:s}),e.jsx(Gn,{}),t&&e.jsx(Zn,{open:!!t,onClose:()=>a(null),user:t}),n&&e.jsx(Xn,{open:!!n,onClose:()=>o(null),user:n})]}),e.jsx(be,{value:"nodes",children:e.jsx(Io,{})}),e.jsx(be,{value:"certificates",children:e.jsx(zo,{})})]}),e.jsx(Kn,{}),e.jsx(qn,{}),e.jsx(pn,{})]}),e.jsx(rr,{})]})},Fo=s=>f.createElement("svg",{viewBox:"0 0 747 747",fill:"none",xmlns:"http://www.w3.org/2000/svg",...s},f.createElement("path",{d:"M746.671 209.652V77.6572C746.671 72.9384 743.827 68.6832 739.468 66.8811C735.108 65.0738 730.093 66.0739 726.754 69.4072L579.354 216.807C577.453 202.386 570.203 189.203 559.037 179.87C547.875 170.542 533.615 165.744 519.083 166.432C504.551 167.12 490.807 173.24 480.573 183.583L414.375 249.776C412.417 235.391 405.141 222.25 393.985 212.959C382.823 203.662 368.594 198.88 354.083 199.552C339.578 200.224 325.849 206.302 315.594 216.588L274.343 257.828L19.9167 3.41515C16.5781 0.0818157 11.5625 -0.918184 7.20306 0.889149C2.84373 2.69648 0 6.94648 0 11.6651V143.649C0 146.743 1.22917 149.712 3.41667 151.899L191.843 340.339L3.41667 528.753C1.2292 530.94 0 533.909 0 537.003V668.997C0 673.716 2.84373 677.971 7.20306 679.773C11.5624 681.581 16.578 680.58 19.9167 677.247L167.317 529.847C169.285 544.233 176.561 557.358 187.718 566.65C198.869 575.947 213.098 580.728 227.603 580.066C242.103 579.404 255.838 573.342 266.098 563.071L332.295 496.874V496.879C334.259 511.264 341.535 524.395 352.691 533.686C363.853 542.977 378.082 547.759 392.587 547.092C407.093 546.421 420.822 540.348 431.077 530.066L472.327 488.826L726.754 743.239C728.941 745.427 731.91 746.656 735.004 746.656C736.535 746.661 738.056 746.359 739.473 745.77C743.832 743.963 746.671 739.708 746.671 734.989V602.994C746.671 599.901 745.442 596.932 743.254 594.744L554.827 406.318L743.254 217.904H743.259C745.447 215.717 746.676 212.748 746.676 209.654L746.671 209.652ZM23.3373 39.8118L257.844 274.318L208.328 323.818L23.3413 138.818L23.3373 39.8118ZM723.337 706.825L488.831 472.318L538.347 422.818L723.333 607.818L723.337 706.825ZM23.3373 541.825L332.097 233.078C338.764 226.719 347.624 223.172 356.843 223.172C366.056 223.172 374.916 226.719 381.588 233.078C388.151 239.641 391.838 248.548 391.838 257.828C391.838 267.114 388.151 276.016 381.588 282.577L23.3347 640.831L23.3373 541.825ZM249.604 546.575C240.755 555.419 227.864 558.872 215.781 555.638C203.703 552.398 194.265 542.961 191.027 530.883C187.792 518.8 191.245 505.91 200.089 497.06L497.076 200.074C505.92 191.23 518.811 187.772 530.893 191.011C542.971 194.246 552.409 203.678 555.648 215.76C558.888 227.839 555.434 240.73 546.591 249.572L249.604 546.575ZM723.337 204.815L414.577 513.562C407.911 519.926 399.051 523.473 389.832 523.473C380.618 523.473 371.753 519.926 365.087 513.562C358.529 506.999 354.842 498.098 354.842 488.816C354.842 479.535 358.529 470.634 365.087 464.071L723.34 105.818L723.337 204.815Z",fill:"currentColor"})),Po=oe({username:N().min(1,"login.fieldRequired"),password:N().min(1,"login.fieldRequired")}),Wo=s=>e.jsx(Ua,{...s,className:`h-5 w-5 stroke-[2px] ${s.className??""}`}),ft=()=>{const{t:s}=E(),r=Ta(),t=La(),[a,n]=f.useState(""),[o,c]=f.useState(!1),{register:l,formState:{errors:x},handleSubmit:d}=qe({resolver:Is(Po)});f.useEffect(()=>{Ja(),t.pathname!=="/login"&&r("/login",{replace:!0})},[]);const m=v=>{n("");const g=new FormData;g.append("username",v.username),g.append("password",v.password),g.append("grant_type","password"),c(!0),I.post("/api/admin/token",g).then(({access_token:S})=>{Za(S),window.location.href="http://localhost:3000/admin/#/"}).catch(S=>n(S?.response?._data?.detail??"Error")).finally(()=>c(!1))};return e.jsxs(F,{minH:"100vh",w:"full",p:6,justify:"space-between",children:[e.jsxs(i,{w:"full",children:[e.jsx(b,{justify:"flex-end",children:e.jsx(ar,{})}),e.jsx(b,{justify:"center",children:e.jsxs(i,{w:"full",maxW:"340px",mt:6,children:[e.jsxs(F,{children:[e.jsx(Fo,{width:48,height:48}),e.jsx(p,{fontSize:"2xl",fontWeight:"semibold",children:s("login.title")}),e.jsx(p,{color:"gray.600",_dark:{color:"gray.400"},children:s("login.welcomeBack")})]}),e.jsx(i,{maxW:"300px",mx:"auto",pt:4,children:e.jsx("form",{onSubmit:d(m),children:e.jsxs(F,{gap:2,children:[e.jsxs(O,{invalid:!!x.username,children:[e.jsx(M,{children:s("username")}),e.jsx(H,{placeholder:s("username"),...l("username")}),x.username&&e.jsx(ge,{children:s(x.username.message)})]}),e.jsxs(O,{invalid:!!x.password,children:[e.jsx(M,{children:s("password")}),e.jsx(H,{type:"password",placeholder:s("password"),...l("password")}),x.password&&e.jsx(ge,{children:s(x.password.message)})]}),a&&e.jsx(Me,{status:"error",borderRadius:"md",children:e.jsx(Be,{children:a})}),e.jsxs(L,{type:"submit",w:"full",colorPalette:"primary",loading:o,children:[e.jsx(Wo,{className:"me-1"}),s("login")]})]})})})]})})]}),e.jsx(rr,{})]})},$o=async()=>{try{const s=await I.get("/admin");return console.log("Admin loader success:",s),s}catch(s){throw console.error("Admin loader failed:",s),s}},Oo=Aa([{path:"/",element:e.jsx(No,{}),errorElement:e.jsx(ft,{}),loader:$o},{path:"/login",element:e.jsx(ft,{})}]);P.extend(Ea);P.extend(Ia);P.extend(za);P.extend(Na);P.extend(Fa);const Mo=()=>e.jsx(i,{height:"100vh",display:"flex",alignItems:"center",justifyContent:"center",children:e.jsx(Ne,{size:"xl",color:"sage.solid"})});Zt("light");Pa.createRoot(document.getElementById("root")).render(e.jsx(Wa.StrictMode,{children:e.jsx($a,{attribute:"class",defaultTheme:"system",enableSystem:!0,disableTransitionOnChange:!1,children:e.jsx(Oa,{value:Ka,children:e.jsx(Ma,{client:vs,children:e.jsx(f.Suspense,{fallback:e.jsx(Mo,{}),children:e.jsx(Ba,{router:Oo})})})})})}));
